<!DOCTYPE html>
<html><head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="canonical" href="https://heheiscool.github.io/posters/mystudy/2021-10-10%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A004-%E5%8A%A0%E5%AF%86%E7%8C%AB/">

    <title>
        
        区块链-solidity学习04-加密猫 | Material Docs
        
    </title>

    
    <link href="https://heheiscool.github.io/css/fontawesome.min.css" rel="stylesheet">

    
    <link rel="stylesheet" href="https://heheiscool.github.io/css/ace.min.css">

    

    
    
        
    

</head>
<body><nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow sticky-top" id="navbarMain">
    <div class="container">
        <div>
            <a class="navbar-brand" href="/">
                
                Material Docs
            </a>
        </div>
        
    </div>
    </nav>
<div class="container-fluid">
            <div class="row">

                <div class="docs-sidenav order-0 col-12 col-md-3 col-lg-2 col-xl-2 position-sticky border-right"><nav class="navbar navbar-expand-md navbar-light pl-0">
    <button class="navbar-toggler navbar-toggler-right collapsed" type="button" data-toggle="collapse" data-target="#sidenav-left-collapse" aria-controls="sidenav-left-collapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

     <div class="collapse navbar-collapse align-items-start flex-column" id="sidenav-left-collapse">
            <form class="form-inline my-2 my-lg-0 searchbox">
                <input class="form-control mr-sm-2 w-100" data-search-input id="search-by" type="text" placeholder="Search">
            </form>
         <ul class="navbar-nav flex-column pt-3">
    <li data-nav-id="/posters/" class="nav-item my-1 parent haschildren
        ">
        
        <a class="nav-link p-0" href="/posters/"><h6>Ace documentation</h6></a>
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/posters/getting-started/" class="nav-item my-1 haschildren
        ">
        
        <a class="nav-link p-0" href="/posters/getting-started/"><h6>Getting started</h6></a>
        <ul class="list-unstyled ml-2">
        <li data-nav-id="/posters/getting-started/installation/" class="nav-item my-1">
                
                 <a href="/posters/getting-started/installation/" class="nav-link p-0">
                    Installation
                </a>
        </li>
        <li data-nav-id="/posters/getting-started/usage/" class="nav-item my-1">
                
                 <a href="/posters/getting-started/usage/" class="nav-link p-0">
                    Usage
                </a>
        </li>
        </ul>
    </li>
    <li data-nav-id="/posters/configuration/" class="nav-item my-1
        ">
        
        <a class="nav-link p-0" href="/posters/configuration/"><h6>Configuration</h6></a>
    </li>
    <li data-nav-id="/posters/shortcodes/" class="nav-item my-1 haschildren
        ">
        
        <a class="nav-link p-0" href="/posters/shortcodes/"><h6>Shortcodes</h6></a>
        <ul class="list-unstyled ml-2">
        <li data-nav-id="/posters/shortcodes/alerts/" class="nav-item my-1">
                
                 <a href="/posters/shortcodes/alerts/" class="nav-link p-0">
                    Alerts
                </a>
        </li>
        <li data-nav-id="/posters/shortcodes/buttons/" class="nav-item my-1">
                
                 <a href="/posters/shortcodes/buttons/" class="nav-link p-0">
                    Buttons
                </a>
        </li>
        <li data-nav-id="/posters/shortcodes/childpages/" class="nav-item my-1">
                
                 <a href="/posters/shortcodes/childpages/" class="nav-link p-0">
                    Childpages
                </a>
        </li>
        <li data-nav-id="/posters/shortcodes/code/" class="nav-item my-1">
                
                 <a href="/posters/shortcodes/code/" class="nav-link p-0">
                    Code
                </a>
        </li>
        <li data-nav-id="/posters/shortcodes/collapse/" class="nav-item my-1">
                
                 <a href="/posters/shortcodes/collapse/" class="nav-link p-0">
                    Collapse
                </a>
        </li>
        <li data-nav-id="/posters/shortcodes/doublecode/" class="nav-item my-1">
                
                 <a href="/posters/shortcodes/doublecode/" class="nav-link p-0">
                    Doublecode
                </a>
        </li>
        <li data-nav-id="/posters/shortcodes/lead/" class="nav-item my-1">
                
                 <a href="/posters/shortcodes/lead/" class="nav-link p-0">
                    Lead
                </a>
        </li>
        <li data-nav-id="/posters/shortcodes/panel/" class="nav-item my-1">
                
                 <a href="/posters/shortcodes/panel/" class="nav-link p-0">
                    Panel
                </a>
        </li>
        <li data-nav-id="/posters/shortcodes/table/" class="nav-item my-1">
                
                 <a href="/posters/shortcodes/table/" class="nav-link p-0">
                    Table
                </a>
        </li>
        </ul>
    </li>
    <li data-nav-id="/posters/mystudy/" class="nav-item my-1 parent haschildren
        ">
        
        <a class="nav-link p-0" href="/posters/mystudy/"><h6>hugo文档管理工具</h6></a>
        <ul class="list-unstyled ml-2">
        <li data-nav-id="/posters/mystudy/2021-11-01%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A0-%E9%AB%98%E7%BA%A7%E7%9F%A5%E8%AF%8606/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-11-01%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A0-%E9%AB%98%E7%BA%A7%E7%9F%A5%E8%AF%8606/" class="nav-link p-0">
                    
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-10-12javascript%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%AC%94%E8%AE%B0/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-10-12javascript%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%AC%94%E8%AE%B0/" class="nav-link p-0">
                    2021-10-12javascript核心原理笔记
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-10-15%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A005-truffle%E4%B8%8Ejs/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-10-15%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A005-truffle%E4%B8%8Ejs/" class="nav-link p-0">
                    2021-10-15区块链-solidity学习05
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-10-20go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A001-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-10-20go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A001-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" class="nav-link p-0">
                    2021-10-20go语言学习01-环境配置
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-10-23%E5%8C%BA%E4%BA%8F%E9%93%BE-dapp%E5%B9%B3%E5%8F%B0%E7%9B%B8%E5%AE%B9%E6%80%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-10-23%E5%8C%BA%E4%BA%8F%E9%93%BE-dapp%E5%B9%B3%E5%8F%B0%E7%9B%B8%E5%AE%B9%E6%80%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="nav-link p-0">
                    2021-10-23区亏链-Dapp平台相容性解决方案
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-10-24javascript-react01%E5%BF%AB%E9%80%9F%E5%AD%A6%E4%B9%A0/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-10-24javascript-react01%E5%BF%AB%E9%80%9F%E5%AD%A6%E4%B9%A0/" class="nav-link p-0">
                    2021-10-24javascript-react快速入门
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-10-24javascript%E6%A8%A1%E5%9D%97%E5%8C%96%E7%BC%96%E7%A8%8B/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-10-24javascript%E6%A8%A1%E5%9D%97%E5%8C%96%E7%BC%96%E7%A8%8B/" class="nav-link p-0">
                    2021-10-24javascript模块化编程
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-10-29python%E7%BC%96%E8%BE%91%E5%99%A8jupyter/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-10-29python%E7%BC%96%E8%BE%91%E5%99%A8jupyter/" class="nav-link p-0">
                    2021-10-24python编译器Jupyter
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-10-27thinkphp%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-10-27thinkphp%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/" class="nav-link p-0">
                    2021-10-24thinkphp插件开发
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-11-04javascript-react02%E7%BC%96%E7%A8%8B/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-11-04javascript-react02%E7%BC%96%E7%A8%8B/" class="nav-link p-0">
                    2021-11-07javascript-react快速入门
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-10-11%E5%8D%9A%E5%AE%A2%E5%8F%8A%E6%96%87%E6%A1%A3%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-hugo/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-10-11%E5%8D%9A%E5%AE%A2%E5%8F%8A%E6%96%87%E6%A1%A3%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-hugo/" class="nav-link p-0">
                    hugo文档管理工具
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-10-11%E6%96%87%E6%A1%A3%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-10-11%E6%96%87%E6%A1%A3%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/" class="nav-link p-0">
                    hugo文档管理工具
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-09-21%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A001/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-09-21%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A001/" class="nav-link p-0">
                    区块链-solidity学习01
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-10-09%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A002/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-10-09%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A002/" class="nav-link p-0">
                    区块链-solidity学习02
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-10-10%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A003/" class="nav-item my-1">
                
                 <a href="/posters/mystudy/2021-10-10%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A003/" class="nav-link p-0">
                    区块链-solidity学习03
                </a>
        </li>
        <li data-nav-id="/posters/mystudy/2021-10-10%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A004-%E5%8A%A0%E5%AF%86%E7%8C%AB/" class="nav-item my-1 active">
                
                 <a href="/posters/mystudy/2021-10-10%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A004-%E5%8A%A0%E5%AF%86%E7%8C%AB/" class="nav-link p-0">
                    区块链-solidity学习04-加密猫
                </a>
        </li>
        </ul>
    </li>
        </ul>
    </li>
        </ul>
    </div>
</nav>


</div>
                <div class="docs-toc large order-lg-2 order-md-0 order-xs-1 col-12 col-lg-2 col-xl-2 position-sticky border-left"><div class="docs-toc">
	<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#加密猫需求">加密猫需求</a></li>
      </ul>
    </li>
    <li><a href="#区块链开发部分"><strong>区块链开发部分</strong></a>
      <ul>
        <li><a href="#主线代码">主线代码</a></li>
        <li><a href="#拍卖代码">拍卖代码</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div>
</div>
                <div class="main col-12 order-1 col-md-9 col-lg-10 col-xl-8 py-3">
                

<h1>区块链-solidity学习04-加密猫</h1>

<p>date: 2021-10-10T10:06:52+08:00</p>
<p>draft: true</p>
<h3 id="加密猫需求">加密猫需求</h3>
<ul>
<li>低价买猫，高价卖猫。</li>
<li>让你的猫提供繁衍的服务，你收取对方的服务费，对方获得繁衍的猫。越珍贵的猫，服务价格越高。</li>
<li>你付出服务费，获得繁衍出的猫，然后卖出去。</li>
</ul>
<p>额外的费用 - 因为迷恋猫运行在以太坊，因此你的操作需要支付Gas费用，例如拍卖猫、购买猫、提供繁衍服务、选择繁衍服务、取消拍卖、取消繁衍等。</p>
<p><strong>2.拍卖逻辑</strong></p>
<p>在游戏中，你可以设置拍卖的起始价格、终止价格、拍卖时长；然后拍卖的当前价格是在拍卖时长的范围内从起始价格线性变化到终止价格。如果有人在一个时刻使用当前价格进行了购买，他就能获得这只猫。</p>
<p><strong>3. 价格因素</strong></p>
<p>什么决定了一只猫的价格呢？物以稀为贵。每只猫都会有自己的“代”、繁衍速度、基因特征、稀有度等等。猜一猜，下面哪只猫的价格更高呢？</p>
<p><strong>4. 繁衍体系</strong></p>
<p>第几代</p>
<p>每只猫都有自己的代，由创始团队发布的猫是0代猫。一个x代猫和y代猫繁衍的下一代是max(x,y)+1。比较特殊的是，一只猫是不分性别的。</p>
<p>修养时间</p>
<p>每当猫繁衍之后，她需要修养一段时间，这是由Cooldown的特征所决定，不同的特征，需要的修养时间不同，具体如下表：</p>
<p>![image-20211011170101152](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011170101152.png)</p>
<p>一只猫的修养特征由她的代所决定。一只3代的猫的修养特征是Swift。当这只猫繁衍后，它的特征会变化。每次繁衍等同于增加了一个代。如果这只3代猫繁衍了3次，她的修养特征会变成第6代的Snappy。这样就限制了一只猫的繁衍速度，增加了低代的稀有价值，也限制了稀有基因的遗传效率。</p>
<p><strong>5. 基因特征</strong></p>
<p>基因性状</p>
<p>![image-20211011173508475](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011173508475.png)</p>
<p>一只猫的基因示例如上图中的最下面一行。基因一共被分为了12块，除了前三块的效果不详，后面几块基因分别对应了不同的性状:</p>
<p>![image-20211011173546694](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011173546694.png)</p>
<p>基因编码</p>
<p>针对一个256位的基因编码，去掉前16位的0，剩余240位。将每五位通过kai编码，形成48的kai编码。每四个一组，形成12块。对应了上节所说的基因块。在每一个基因块中，第四位表示了当前猫的显性性状，其它倒数第二位、第三位、第四位分别表示了第一、第二、第三隐性性状。</p>
<p>在这里特别的Kai编码使用了数字和小写字母，为了肉眼识别时可能引入的误看，因此Kai编码没有使用0和L。于是基于5个二进制，一共有32种字符表示，具体如下：</p>
<p>![image-20211011174634656](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011174634656.png)</p>
<p>在这个基础上，我们可以通过一只猫的基因编码确定她的性状。让我们通过眼睛的颜色来举例子：</p>
<p>![image-20211011174846535](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011174846535.png)</p>
<p><strong>6. 基因遗传</strong></p>
<p><strong>基因混合算法：</strong></p>
<p>![image-20211011182943992](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011182943992.png)</p>
<p>基因遗传的具体算法并没有被公开，但是很多牛人基于推断得到了伪码。简单来说，分为三步：</p>
<ol>
<li>双亲的基因基于75%的概率进行轮转，从而有可能让隐性性状便成了显性性状</li>
<li>当双亲的基因相差1的时候，有一定概率会进行变异，产生新的性状</li>
<li>如果没有发生变异，各有50%的概率从双亲继承一段基因</li>
</ol>
<h2 id="区块链开发部分"><strong>区块链开发部分</strong></h2>
<p><strong>基本规则</strong></p>
<ul>
<li>非兄妹父母关系的两只猫可以生育</li>
<li>两只猫可以来自同一个主人，或者一只猫被她的拥有者提供服务</li>
<li>任何一只都可以做父亲（sire）或者母亲（matron）</li>
<li>猫没有性别</li>
<li>交配后，母亲会怀孕，并且进入修养期；父亲也同样会进入修养期</li>
<li>修养期内不能再次剩余，修养期会随着生育次数而增长</li>
<li>母亲的修养期结束后，会生出小猫，并且可以再次生育</li>
<li>主人可以选择拍卖猫或者赠送猫</li>
</ul>
<p><strong>核心流程</strong></p>
<ol>
<li>COO每隔15分钟产生一个0代的猫，并进行拍卖(Main createGen0Auction())</li>
<li>用户可以购买0代猫(Sale Auction bid())</li>
<li>用户可以查询猫的数据(Main getKitty())</li>
<li>用户可以自己繁衍猫(Main breedWith() or breedWithAuto())</li>
<li>修养期后，用户可以得到新的猫(Main giveBirth())</li>
<li>用户可以把一只猫作为父亲，拍卖他的生育服务(Main createSiringAuction())</li>
<li>用户把一只猫作为父亲，为某个以太坊地址提供生育服务(Main approveSiring())</li>
<li>用户可以购买一只猫的生育服务(Main createSiringAuction())</li>
<li>用户可以拍卖他的猫(Main createSaleAuction())</li>
<li>用户可以购买被拍卖的猫(Sale Auction bid())</li>
<li>用户可以查看被拍卖猫的信息(Sale/Siring Auction getAuction())</li>
<li>用户能够取消拍卖(Sale/Siring Auction cancelAuction())</li>
<li>用户能够赠送猫(Main transfer())</li>
<li>用户能够指定另一个用户能够获得他的猫的权限(Main approve())</li>
<li>用户可以认领自己被指定获得权限的猫(Main transferFrom())</li>
<li>只有CEO能够替换COO或者CTO(Main setCEO() setCFO() setCOO())</li>
<li>COO能够创建和操作特殊的猫(Main createPromoKitty())</li>
<li>COO能够转移拍卖的收入(Main withdrawAuctionBalances())</li>
<li>CFO能够转移主协议的收益(Main withdrawBalance())</li>
</ol>
<p><strong>核心协议</strong></p>
<p>迷恋猫的协议关系如下图</p>
<p>![image-20211011184637542](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011184637542.png)</p>
<p>![image-20211011195134341](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011195134341.png)</p>
<p>将拍卖功能解耦出来，作为单独的拍卖行：</p>
<p><!-- raw HTML omitted --></p>
<p>在整个结构中分成三条线</p>
<ul>
<li>中间的主线，定义了迷恋猫的各个核心操作。为了拆解简化，有多个contract完成各自的任务，同时通过协议继承继承了整个关系</li>
<li>左侧的拍卖线，提供了单独的拍卖协议能力</li>
<li>右侧的基因线，仅仅提供新猫基因生成的功能；这样做能够部分实现基因算法的加密，但是也很快被人逆向工程了。</li>
</ul>
<p>代码参考：</p>
<p><a href="https://cloud.tencent.com/developer/article/1120207">https://cloud.tencent.com/developer/article/1120207</a></p>
<p>合约除拍卖交易、基因算法的完整代码：</p>
<p><a href="https://etherscan.io/address/0x06012c8cf97bead5deae237070f9587f8e7a266d#code">https://etherscan.io/address/0x06012c8cf97bead5deae237070f9587f8e7a266d#code</a></p>
<h3 id="主线代码">主线代码</h3>
<p>KittyAccessControl</p>
<p>![image-20211011195746972](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011195746972.png)</p>
<p>![image-20211011195827493](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011195827493.png)</p>
<p>![image-20211011210931005](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011210931005.png)</p>
<p>![image-20211011212101076](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011212101076.png)</p>
<p>![image-20211011213148811](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011213148811.png)</p>
<p>KittyBase合约</p>
<p>![image-20211011213533103](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011213533103.png)</p>
<p>![image-20211011214007764](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011214007764.png)</p>
<p>![image-20211011214135145](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011214135145.png)</p>
<p>![image-20211011214652850](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011214652850.png)</p>
<p>![image-20211011214811713](/Users/chenyang/Library/Application Support/typora-user-images/image-20211011214811713.png)</p>
<p>![image-20211012004128701](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012004128701.png)</p>
<p>![image-20211012004210161](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012004210161.png)</p>
<p>![image-20211012004254536](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012004254536.png)</p>
<p>address(0)=0x0000&hellip;为特殊的零号地址，用来注册约合的交易地址！</p>
<p>ERC721</p>
<p>![image-20211012004655402](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012004655402.png)</p>
<p>ERC721Metadata</p>
<p>![image-20211012005102100](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012005102100.png)</p>
<p>KittyOwnerShip</p>
<p>![image-20211012005321672](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012005321672.png)</p>
<p>![image-20211012005400041](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012005400041.png)</p>
<p>![image-20211012005517297](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012005517297.png)</p>
<p>![image-20211012005619299](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012005619299.png)</p>
<p>![image-20211012005651671](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012005651671.png)</p>
<p>![image-20211012005719322](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012005719322.png)</p>
<p>![image-20211012005758958](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012005758958.png)</p>
<p>![image-20211012005910797](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012005910797.png)</p>
<p>![image-20211012005926952](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012005926952.png)</p>
<p>KittyBreading</p>
<p>![image-20211012010111069](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012010111069.png)</p>
<p>![image-20211012010710807](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012010710807.png)</p>
<p>![image-20211012010746784](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012010746784.png)</p>
<p>![image-20211012010818604](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012010818604.png)</p>
<p>![image-20211012010905138](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012010905138.png)</p>
<p>![image-20211012011017524](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012011017524.png)</p>
<p>![image-20211012011144670](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012011144670.png)</p>
<p>![image-20211012011234120](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012011234120.png)</p>
<p>![image-20211012011409030](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012011409030.png)</p>
<p>![image-20211012011501259](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012011501259.png)</p>
<p>![image-20211012011540111](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012011540111.png)</p>
<p>![image-20211012011711808](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012011711808.png)</p>
<p>创建初代猫</p>
<p>KittyMinting 继承了拍卖合约</p>
<p>![image-20211012095511094](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012095511094.png)</p>
<p>![image-20211012095634696](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012095634696.png)</p>
<p>![image-20211012095837165](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012095837165.png)</p>
<p>KittyCore 主合约，也是合约入口，组合所有的功能，初始化合约</p>
<p>![image-20211012095924284](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012095924284.png)</p>
<p>![image-20211012100109442](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012100109442.png)</p>
<p>![image-20211012100214708](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012100214708.png)</p>
<p>![image-20211012103618489](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012103618489.png)</p>
<p>![image-20211012103714524](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012103714524.png)</p>
<p>![image-20211012103739975](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012103739975.png)</p>
<h3 id="拍卖代码">拍卖代码</h3>
<p>Ownable</p>
<p>![image-20211012011849132](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012011849132.png)</p>
<p>![image-20211012011904899](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012011904899.png)</p>
<p>Pausable</p>
<p>![image-20211012011941026](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012011941026.png)</p>
<p>ClockAuctionBase</p>
<p>![image-20211012012104973](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012012104973.png)</p>
<p>![image-20211012012133792](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012012133792.png)</p>
<p>![image-20211012012201090](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012012201090.png)</p>
<p>![image-20211012012321419](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012012321419.png)</p>
<p>![image-20211012012341956](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012012341956.png)</p>
<p>![image-20211012012644001](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012012644001.png)</p>
<p>![image-20211012012741851](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012012741851.png)</p>
<p>![image-20211012012824918](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012012824918.png)</p>
<p>![image-20211012012958502](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012012958502.png)</p>
<p>![image-20211012013019267](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012013019267.png)</p>
<p>ClockAuction(提供计时)</p>
<p>![image-20211012111531680](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012111531680.png)</p>
<p>![image-20211012112536852](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012112536852.png)</p>
<p>![image-20211012112227515](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012112227515.png)</p>
<p>![image-20211012112611285](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012112611285.png)</p>
<p>![image-20211012112758509](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012112758509.png)</p>
<p>![image-20211012112817365](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012112817365.png)</p>
<p>StringClockAuction 交配拍卖</p>
<p>![image-20211012113358849](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012113358849.png)</p>
<p>![image-20211012113423414](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012113423414.png)</p>
<p>SaleClockAuction 销售拍卖</p>
<p>![image-20211012131235394](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012131235394.png)</p>
<p>![image-20211012131302713](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012131302713.png)</p>
<p>![image-20211012131326283](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012131326283.png)</p>
<p>KittyAuction(处理销售拍卖 )</p>
<p>![image-20211012093318884](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012093318884.png)</p>
<p>![image-20211012093413486](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012093413486.png)</p>
<p>![image-20211012093437693](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012093437693.png)</p>
<p>![image-20211012093539759](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012093539759.png)</p>
<p>![image-20211012093644425](/Users/chenyang/Library/Application Support/typora-user-images/image-20211012093644425.png)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-solidity" data-lang="solidity"><span style="color:#75715e">/**
</span><span style="color:#75715e"> *Submitted for verification at Etherscan.io on 2017-11-28
</span><span style="color:#75715e">*/</span>

<span style="color:#66d9ef">pragma solidity</span> <span style="color:#f92672">^</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">4</span>.<span style="color:#ae81ff">11</span>;


<span style="color:#75715e">/**
</span><span style="color:#75715e"> * @title Ownable
</span><span style="color:#75715e"> * @dev The Ownable contract has an owner address, and provides basic authorization control
</span><span style="color:#75715e"> * functions, this simplifies the implementation of &#34;user permissions&#34;.
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">Ownable</span> {
  <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> owner;


  <span style="color:#75715e">/**
</span><span style="color:#75715e">   * @dev The Ownable constructor sets the original `owner` of the contract to the sender
</span><span style="color:#75715e">   * account.
</span><span style="color:#75715e">   */</span>
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Ownable</span>() {
    owner <span style="color:#f92672">=</span> msg.sender;
  }


  <span style="color:#75715e">/**
</span><span style="color:#75715e">   * @dev Throws if called by any account other than the owner.
</span><span style="color:#75715e">   */</span>
  <span style="color:#66d9ef">modifier</span> <span style="color:#a6e22e">onlyOwner</span>() {
    require(msg.sender <span style="color:#f92672">==</span> owner);
    <span style="color:#66d9ef">_</span>;
  }


  <span style="color:#75715e">/**
</span><span style="color:#75715e">   * @dev Allows the current owner to transfer control of the contract to a newOwner.
</span><span style="color:#75715e">   * @param newOwner The address to transfer ownership to.
</span><span style="color:#75715e">   */</span>
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">transferOwnership</span>(<span style="color:#66d9ef">address</span> newOwner) onlyOwner {
    <span style="color:#66d9ef">if</span> (newOwner <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>)) {
      owner <span style="color:#f92672">=</span> newOwner;
    }
  }

}



<span style="color:#75715e">/// @title Interface for contracts conforming to ERC-721: Non-Fungible Tokens
</span><span style="color:#75715e">/// @author Dieter Shirley &lt;dete@axiomzen.co&gt; (https://github.com/dete)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">ERC721</span> {
    <span style="color:#75715e">// Required methods
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">totalSupply</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint256</span> total);
    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">balanceOf</span>(<span style="color:#66d9ef">address</span> _owner) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint256</span> balance);
    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">ownerOf</span>(<span style="color:#66d9ef">uint256</span> _tokenId) <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">address</span> owner);
    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">approve</span>(<span style="color:#66d9ef">address</span> _to, <span style="color:#66d9ef">uint256</span> _tokenId) <span style="color:#66d9ef">external</span>;
    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">transfer</span>(<span style="color:#66d9ef">address</span> _to, <span style="color:#66d9ef">uint256</span> _tokenId) <span style="color:#66d9ef">external</span>;
    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">transferFrom</span>(<span style="color:#66d9ef">address</span> _from, <span style="color:#66d9ef">address</span> _to, <span style="color:#66d9ef">uint256</span> _tokenId) <span style="color:#66d9ef">external</span>;

    <span style="color:#75715e">// Events
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">Transfer</span>(<span style="color:#66d9ef">address</span> <span style="color:#66d9ef">from</span>, <span style="color:#66d9ef">address</span> to, <span style="color:#66d9ef">uint256</span> tokenId);
    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">Approval</span>(<span style="color:#66d9ef">address</span> owner, <span style="color:#66d9ef">address</span> approved, <span style="color:#66d9ef">uint256</span> tokenId);

    <span style="color:#75715e">// Optional
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// function name() public view returns (string name);
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// function symbol() public view returns (string symbol);
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// function tokensOfOwner(address _owner) external view returns (uint256[] tokenIds);
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// function tokenMetadata(uint256 _tokenId, string _preferredTransport) public view returns (string infoUrl);
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// ERC-165 Compatibility (https://github.com/ethereum/EIPs/issues/165)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">supportsInterface</span>(<span style="color:#66d9ef">bytes4</span> _interfaceID) <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>);
}


<span style="color:#75715e">// // Auction wrapper functions
</span><span style="color:#75715e"></span>

<span style="color:#75715e">// Auction wrapper functions
</span><span style="color:#75715e"></span>






<span style="color:#75715e">/// @title SEKRETOOOO
</span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">GeneScienceInterface</span> {
    <span style="color:#75715e">/// @dev simply a boolean to indicate this is the contract we expect to be
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isGeneScience</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>);

    <span style="color:#75715e">/// @dev given genes of kitten 1 &amp; 2, return a genetic combination - may have a random factor
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param genes1 genes of mom
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param genes2 genes of sire
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @return the genes that are supposed to be passed down the child
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">mixGenes</span>(<span style="color:#66d9ef">uint256</span> genes1, <span style="color:#66d9ef">uint256</span> genes2, <span style="color:#66d9ef">uint256</span> targetBlock) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint256</span>);
}







<span style="color:#75715e">/// @title A facet of KittyCore that manages special access privileges.
</span><span style="color:#75715e">/// @author Axiom Zen (https://www.axiomzen.co)
</span><span style="color:#75715e">/// @dev See the KittyCore contract documentation to understand how the various contract facets are arranged.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">KittyAccessControl</span> {
    <span style="color:#75715e">// This facet controls access control for CryptoKitties. There are four roles managed here:
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//     - The CEO: The CEO can reassign other roles and change the addresses of our dependent smart
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//         contracts. It is also the only role that can unpause the smart contract. It is initially
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//         set to the address that created the smart contract in the KittyCore constructor.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//     - The CFO: The CFO can withdraw funds from KittyCore and its auction contracts.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//     - The COO: The COO can release gen0 kitties to auction, and mint promo cats.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// It should be noted that these roles are distinct without overlap in their access abilities, the
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// abilities listed for each role above are exhaustive. In particular, while the CEO can assign any
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// address to any role, the CEO address itself doesn&#39;t have the ability to act in those roles. This
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// restriction is intentional so that we aren&#39;t tempted to use the CEO address frequently out of
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// convenience. The less we use an address, the less likely it is that we somehow compromise the
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// account.
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">/// @dev Emited when contract is upgraded - See README.md for updgrade plan
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">ContractUpgrade</span>(<span style="color:#66d9ef">address</span> newContract);

    <span style="color:#75715e">// The addresses of the accounts (or contracts) that can execute actions within each roles.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> ceoAddress;
    <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> cfoAddress;
    <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> cooAddress;

    <span style="color:#75715e">// @dev Keeps track whether the contract is paused. When that is true, most actions are blocked
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">public</span> paused <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;

    <span style="color:#75715e">/// @dev Access modifier for CEO-only functionality
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">modifier</span> <span style="color:#a6e22e">onlyCEO</span>() {
        require(msg.sender <span style="color:#f92672">==</span> ceoAddress);
        <span style="color:#66d9ef">_</span>;
    }

    <span style="color:#75715e">/// @dev Access modifier for CFO-only functionality
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">modifier</span> <span style="color:#a6e22e">onlyCFO</span>() {
        require(msg.sender <span style="color:#f92672">==</span> cfoAddress);
        <span style="color:#66d9ef">_</span>;
    }

    <span style="color:#75715e">/// @dev Access modifier for COO-only functionality
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">modifier</span> <span style="color:#a6e22e">onlyCOO</span>() {
        require(msg.sender <span style="color:#f92672">==</span> cooAddress);
        <span style="color:#66d9ef">_</span>;
    }

    <span style="color:#66d9ef">modifier</span> <span style="color:#a6e22e">onlyCLevel</span>() {
        require(
            msg.sender <span style="color:#f92672">==</span> cooAddress <span style="color:#f92672">||</span>
            msg.sender <span style="color:#f92672">==</span> ceoAddress <span style="color:#f92672">||</span>
            msg.sender <span style="color:#f92672">==</span> cfoAddress
        );
        <span style="color:#66d9ef">_</span>;
    }

    <span style="color:#75715e">/// @dev Assigns a new address to act as the CEO. Only available to the current CEO.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _newCEO The address of the new CEO
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setCEO</span>(<span style="color:#66d9ef">address</span> _newCEO) <span style="color:#66d9ef">external</span> onlyCEO {
        require(_newCEO <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>));

        ceoAddress <span style="color:#f92672">=</span> _newCEO;
    }

    <span style="color:#75715e">/// @dev Assigns a new address to act as the CFO. Only available to the current CEO.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _newCFO The address of the new CFO
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setCFO</span>(<span style="color:#66d9ef">address</span> _newCFO) <span style="color:#66d9ef">external</span> onlyCEO {
        require(_newCFO <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>));

        cfoAddress <span style="color:#f92672">=</span> _newCFO;
    }

    <span style="color:#75715e">/// @dev Assigns a new address to act as the COO. Only available to the current CEO.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _newCOO The address of the new COO
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setCOO</span>(<span style="color:#66d9ef">address</span> _newCOO) <span style="color:#66d9ef">external</span> onlyCEO {
        require(_newCOO <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>));

        cooAddress <span style="color:#f92672">=</span> _newCOO;
    }

    <span style="color:#75715e">/*** Pausable functionality adapted from OpenZeppelin ***/</span>

    <span style="color:#75715e">/// @dev Modifier to allow actions only when the contract IS NOT paused
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">modifier</span> <span style="color:#a6e22e">whenNotPaused</span>() {
        require(<span style="color:#f92672">!</span>paused);
        <span style="color:#66d9ef">_</span>;
    }

    <span style="color:#75715e">/// @dev Modifier to allow actions only when the contract IS paused
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">modifier</span> <span style="color:#a6e22e">whenPaused</span> {
        require(paused);
        <span style="color:#66d9ef">_</span>;
    }

    <span style="color:#75715e">/// @dev Called by any &#34;C-level&#34; role to pause the contract. Used only when
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  a bug or exploit is detected and we need to limit damage.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">pause</span>() <span style="color:#66d9ef">external</span> onlyCLevel whenNotPaused {
        paused <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
    }

    <span style="color:#75715e">/// @dev Unpauses the smart contract. Can only be called by the CEO, since
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  one reason we may pause the contract is when CFO or COO accounts are
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  compromised.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @notice This is public rather than external so it can be called by
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  derived contracts.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">unpause</span>() <span style="color:#66d9ef">public</span> onlyCEO whenPaused {
        <span style="color:#75715e">// can&#39;t unpause if contract was upgraded
</span><span style="color:#75715e"></span>        paused <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
    }
}




<span style="color:#75715e">/// @title Base contract for CryptoKitties. Holds all common structs, events and base variables.
</span><span style="color:#75715e">/// @author Axiom Zen (https://www.axiomzen.co)
</span><span style="color:#75715e">/// @dev See the KittyCore contract documentation to understand how the various contract facets are arranged.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">KittyBase</span> <span style="color:#66d9ef">is</span> KittyAccessControl {
    <span style="color:#75715e">/*** EVENTS ***/</span>

    <span style="color:#75715e">/// @dev The Birth event is fired whenever a new kitten comes into existence. This obviously
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  includes any time a cat is created through the giveBirth method, but it is also called
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  when a new gen0 cat is created.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">Birth</span>(<span style="color:#66d9ef">address</span> owner, <span style="color:#66d9ef">uint256</span> kittyId, <span style="color:#66d9ef">uint256</span> matronId, <span style="color:#66d9ef">uint256</span> sireId, <span style="color:#66d9ef">uint256</span> genes);

    <span style="color:#75715e">/// @dev Transfer event as defined in current draft of ERC721. Emitted every time a kitten
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  ownership is assigned, including births.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">Transfer</span>(<span style="color:#66d9ef">address</span> <span style="color:#66d9ef">from</span>, <span style="color:#66d9ef">address</span> to, <span style="color:#66d9ef">uint256</span> tokenId);

    <span style="color:#75715e">/*** DATA TYPES ***/</span>

    <span style="color:#75715e">/// @dev The main Kitty struct. Every cat in CryptoKitties is represented by a copy
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  of this structure, so great care was taken to ensure that it fits neatly into
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  exactly two 256-bit words. Note that the order of the members in this structure
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  is important because of the byte-packing rules used by Ethereum.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  Ref: http://solidity.readthedocs.io/en/develop/miscellaneous.html
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Kitty</span> {
        <span style="color:#75715e">// The Kitty&#39;s genetic code is packed into these 256-bits, the format is
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// sooper-sekret! A cat&#39;s genes never change.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint256</span> genes;

        <span style="color:#75715e">// The timestamp from the block when this cat came into existence.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint64</span> birthTime;

        <span style="color:#75715e">// The minimum timestamp after which this cat can engage in breeding
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// activities again. This same timestamp is used for the pregnancy
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// timer (for matrons) as well as the siring cooldown.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint64</span> cooldownEndBlock;

        <span style="color:#75715e">// The ID of the parents of this kitty, set to 0 for gen0 cats.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Note that using 32-bit unsigned integers limits us to a &#34;mere&#34;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// 4 billion cats. This number might seem small until you realize
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// that Ethereum currently has a limit of about 500 million
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// transactions per year! So, this definitely won&#39;t be a problem
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// for several years (even as Ethereum learns to scale).
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint32</span> matronId;
        <span style="color:#66d9ef">uint32</span> sireId;

        <span style="color:#75715e">// Set to the ID of the sire cat for matrons that are pregnant,
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// zero otherwise. A non-zero value here is how we know a cat
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// is pregnant. Used to retrieve the genetic material for the new
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// kitten when the birth transpires.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint32</span> siringWithId;

        <span style="color:#75715e">// Set to the index in the cooldown array (see below) that represents
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// the current cooldown duration for this Kitty. This starts at zero
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// for gen0 cats, and is initialized to floor(generation/2) for others.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Incremented by one for each successful breeding action, regardless
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// of whether this cat is acting as matron or sire.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint16</span> cooldownIndex;

        <span style="color:#75715e">// The &#34;generation number&#34; of this cat. Cats minted by the CK contract
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// for sale are called &#34;gen0&#34; and have a generation number of 0. The
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// generation number of all other cats is the larger of the two generation
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// numbers of their parents, plus one.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// (i.e. max(matron.generation, sire.generation) + 1)
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint16</span> generation;
    }

    <span style="color:#75715e">/*** CONSTANTS ***/</span>

    <span style="color:#75715e">/// @dev A lookup table indicating the cooldown duration after any successful
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  breeding action, called &#34;pregnancy time&#34; for matrons and &#34;siring cooldown&#34;
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  for sires. Designed such that the cooldown roughly doubles each time a cat
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  is bred, encouraging owners not to just keep breeding the same cat over
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  and over again. Caps out at one week (a cat can breed an unbounded number
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  of times, and the maximum cooldown is always seven days).
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint32</span>[<span style="color:#ae81ff">14</span>] <span style="color:#66d9ef">public</span> cooldowns <span style="color:#f92672">=</span> [
        <span style="color:#66d9ef">uint32</span>(<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">minutes</span>),
        <span style="color:#66d9ef">uint32</span>(<span style="color:#ae81ff">2</span> <span style="color:#66d9ef">minutes</span>),
        <span style="color:#66d9ef">uint32</span>(<span style="color:#ae81ff">5</span> <span style="color:#66d9ef">minutes</span>),
        <span style="color:#66d9ef">uint32</span>(<span style="color:#ae81ff">10</span> <span style="color:#66d9ef">minutes</span>),
        <span style="color:#66d9ef">uint32</span>(<span style="color:#ae81ff">30</span> <span style="color:#66d9ef">minutes</span>),
        <span style="color:#66d9ef">uint32</span>(<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">hours</span>),
        <span style="color:#66d9ef">uint32</span>(<span style="color:#ae81ff">2</span> <span style="color:#66d9ef">hours</span>),
        <span style="color:#66d9ef">uint32</span>(<span style="color:#ae81ff">4</span> <span style="color:#66d9ef">hours</span>),
        <span style="color:#66d9ef">uint32</span>(<span style="color:#ae81ff">8</span> <span style="color:#66d9ef">hours</span>),
        <span style="color:#66d9ef">uint32</span>(<span style="color:#ae81ff">16</span> <span style="color:#66d9ef">hours</span>),
        <span style="color:#66d9ef">uint32</span>(<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">days</span>),
        <span style="color:#66d9ef">uint32</span>(<span style="color:#ae81ff">2</span> <span style="color:#66d9ef">days</span>),
        <span style="color:#66d9ef">uint32</span>(<span style="color:#ae81ff">4</span> <span style="color:#66d9ef">days</span>),
        <span style="color:#66d9ef">uint32</span>(<span style="color:#ae81ff">7</span> <span style="color:#66d9ef">days</span>)
    ];

    <span style="color:#75715e">// An approximation of currently how many seconds are in between blocks.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint256</span> <span style="color:#66d9ef">public</span> secondsPerBlock <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>;

    <span style="color:#75715e">/*** STORAGE ***/</span>

    <span style="color:#75715e">/// @dev An array containing the Kitty struct for all Kitties in existence. The ID
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  of each cat is actually an index into this array. Note that ID 0 is a negacat,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  the unKitty, the mythical beast that is the parent of all gen0 cats. A bizarre
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  creature that is both matron and sire... to itself! Has an invalid genetic code.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  In other words, cat ID 0 is invalid... ;-)
</span><span style="color:#75715e"></span>    Kitty[] kitties;

    <span style="color:#75715e">/// @dev A mapping from cat IDs to the address that owns them. All cats have
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  some valid owner address, even gen0 cats are created with a non-zero owner.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">mapping</span> (<span style="color:#66d9ef">uint256</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">address</span>) <span style="color:#66d9ef">public</span> kittyIndexToOwner;

    <span style="color:#75715e">// @dev A mapping from owner address to count of tokens that address owns.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//  Used internally inside balanceOf() to resolve ownership count.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">mapping</span> (<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint256</span>) ownershipTokenCount;

    <span style="color:#75715e">/// @dev A mapping from KittyIDs to an address that has been approved to call
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  transferFrom(). Each Kitty can only have one approved address for transfer
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  at any time. A zero value means no approval is outstanding.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">mapping</span> (<span style="color:#66d9ef">uint256</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">address</span>) <span style="color:#66d9ef">public</span> kittyIndexToApproved;

    <span style="color:#75715e">/// @dev A mapping from KittyIDs to an address that has been approved to use
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  this Kitty for siring via breedWith(). Each Kitty can only have one approved
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  address for siring at any time. A zero value means no approval is outstanding.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">mapping</span> (<span style="color:#66d9ef">uint256</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">address</span>) <span style="color:#66d9ef">public</span> sireAllowedToAddress;

    <span style="color:#75715e">/// @dev The address of the ClockAuction contract that handles sales of Kitties. This
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  same contract handles both peer-to-peer sales as well as the gen0 sales which are
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  initiated every 15 minutes.
</span><span style="color:#75715e"></span>    SaleClockAuction <span style="color:#66d9ef">public</span> saleAuction;

    <span style="color:#75715e">/// @dev The address of a custom ClockAuction subclassed contract that handles siring
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  auctions. Needs to be separate from saleAuction because the actions taken on success
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  after a sales and siring auction are quite different.
</span><span style="color:#75715e"></span>    SiringClockAuction <span style="color:#66d9ef">public</span> siringAuction;

    <span style="color:#75715e">/// @dev Assigns ownership of a specific Kitty to an address.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_transfer</span>(<span style="color:#66d9ef">address</span> _from, <span style="color:#66d9ef">address</span> _to, <span style="color:#66d9ef">uint256</span> _tokenId) <span style="color:#66d9ef">internal</span> {
        <span style="color:#75715e">// Since the number of kittens is capped to 2^32 we can&#39;t overflow this
</span><span style="color:#75715e"></span>        ownershipTokenCount[_to]<span style="color:#f92672">++</span>;
        <span style="color:#75715e">// transfer ownership
</span><span style="color:#75715e"></span>        kittyIndexToOwner[_tokenId] <span style="color:#f92672">=</span> _to;
        <span style="color:#75715e">// When creating new kittens _from is 0x0, but we can&#39;t account that address.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (_from <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>)) {
            ownershipTokenCount[_from]<span style="color:#f92672">--</span>;
            <span style="color:#75715e">// once the kitten is transferred also clear sire allowances
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">delete</span> sireAllowedToAddress[_tokenId];
            <span style="color:#75715e">// clear any previously approved ownership exchange
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">delete</span> kittyIndexToApproved[_tokenId];
        }
        <span style="color:#75715e">// Emit the transfer event.
</span><span style="color:#75715e"></span>        Transfer(_from, _to, _tokenId);
    }

    <span style="color:#75715e">/// @dev An internal method that creates a new kitty and stores it. This
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  method doesn&#39;t do any checking and should only be called when the
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  input data is known to be valid. Will generate both a Birth event
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  and a Transfer event.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _matronId The kitty ID of the matron of this cat (zero for gen0)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _sireId The kitty ID of the sire of this cat (zero for gen0)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _generation The generation number of this cat, must be computed by caller.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _genes The kitty&#39;s genetic code.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _owner The inital owner of this cat, must be non-zero (except for the unKitty, ID 0)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_createKitty</span>(
        <span style="color:#66d9ef">uint256</span> _matronId,
        <span style="color:#66d9ef">uint256</span> _sireId,
        <span style="color:#66d9ef">uint256</span> _generation,
        <span style="color:#66d9ef">uint256</span> _genes,
        <span style="color:#66d9ef">address</span> _owner
    )
        <span style="color:#66d9ef">internal</span>
        <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>)
    {
        <span style="color:#75715e">// These requires are not strictly necessary, our calling code should make
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// sure that these conditions are never broken. However! _createKitty() is already
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// an expensive call (for storage), and it doesn&#39;t hurt to be especially careful
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// to ensure our data structures are always valid.
</span><span style="color:#75715e"></span>        require(_matronId <span style="color:#f92672">==</span> <span style="color:#66d9ef">uint256</span>(<span style="color:#66d9ef">uint32</span>(_matronId)));
        require(_sireId <span style="color:#f92672">==</span> <span style="color:#66d9ef">uint256</span>(<span style="color:#66d9ef">uint32</span>(_sireId)));
        require(_generation <span style="color:#f92672">==</span> <span style="color:#66d9ef">uint256</span>(<span style="color:#66d9ef">uint16</span>(_generation)));

        <span style="color:#75715e">// New kitty starts with the same cooldown as parent gen/2
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint16</span> cooldownIndex <span style="color:#f92672">=</span> <span style="color:#66d9ef">uint16</span>(_generation <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>);
        <span style="color:#66d9ef">if</span> (cooldownIndex <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">13</span>) {
            cooldownIndex <span style="color:#f92672">=</span> <span style="color:#ae81ff">13</span>;
        }

        Kitty <span style="color:#66d9ef">memory</span> _kitty <span style="color:#f92672">=</span> Kitty({
            genes<span style="color:#f92672">:</span> _genes,
            birthTime<span style="color:#f92672">:</span> <span style="color:#66d9ef">uint64</span>(now),
            cooldownEndBlock<span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>,
            matronId<span style="color:#f92672">:</span> <span style="color:#66d9ef">uint32</span>(_matronId),
            sireId<span style="color:#f92672">:</span> <span style="color:#66d9ef">uint32</span>(_sireId),
            siringWithId<span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>,
            cooldownIndex<span style="color:#f92672">:</span> cooldownIndex,
            generation<span style="color:#f92672">:</span> <span style="color:#66d9ef">uint16</span>(_generation)
        });
        <span style="color:#66d9ef">uint256</span> newKittenId <span style="color:#f92672">=</span> kitties.push(_kitty) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;

        <span style="color:#75715e">// It&#39;s probably never going to happen, 4 billion cats is A LOT, but
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// let&#39;s just be 100% sure we never let this happen.
</span><span style="color:#75715e"></span>        require(newKittenId <span style="color:#f92672">==</span> <span style="color:#66d9ef">uint256</span>(<span style="color:#66d9ef">uint32</span>(newKittenId)));

        <span style="color:#75715e">// emit the birth event
</span><span style="color:#75715e"></span>        Birth(
            _owner,
            newKittenId,
            <span style="color:#66d9ef">uint256</span>(_kitty.matronId),
            <span style="color:#66d9ef">uint256</span>(_kitty.sireId),
            _kitty.genes
        );

        <span style="color:#75715e">// This will assign ownership, and also emit the Transfer event as
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// per ERC721 draft
</span><span style="color:#75715e"></span>        _transfer(<span style="color:#ae81ff">0</span>, _owner, newKittenId);

        <span style="color:#66d9ef">return</span> newKittenId;
    }

    <span style="color:#75715e">// Any C-level can fix how many seconds per blocks are currently observed.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setSecondsPerBlock</span>(<span style="color:#66d9ef">uint256</span> secs) <span style="color:#66d9ef">external</span> onlyCLevel {
        require(secs <span style="color:#f92672">&lt;</span> cooldowns[<span style="color:#ae81ff">0</span>]);
        secondsPerBlock <span style="color:#f92672">=</span> secs;
    }
}





<span style="color:#75715e">/// @title The external contract that is responsible for generating metadata for the kitties,
</span><span style="color:#75715e">///  it has one function that will return the data as bytes.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">ERC721Metadata</span> {
    <span style="color:#75715e">/// @dev Given a token Id, returns a byte array that is supposed to be converted into string.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getMetadata</span>(<span style="color:#66d9ef">uint256</span> _tokenId, <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bytes32</span>[<span style="color:#ae81ff">4</span>] buffer, <span style="color:#66d9ef">uint256</span> count) {
        <span style="color:#66d9ef">if</span> (_tokenId <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
            buffer[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello World! :D&#34;</span>;
            count <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>;
        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (_tokenId <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>) {
            buffer[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;I would definitely choose a medi&#34;</span>;
            buffer[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;um length string.&#34;</span>;
            count <span style="color:#f92672">=</span> <span style="color:#ae81ff">49</span>;
        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (_tokenId <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>) {
            buffer[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Lorem ipsum dolor sit amet, mi e&#34;</span>;
            buffer[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;st accumsan dapibus augue lorem,&#34;</span>;
            buffer[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34; tristique vestibulum id, libero&#34;</span>;
            buffer[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34; suscipit varius sapien aliquam.&#34;</span>;
            count <span style="color:#f92672">=</span> <span style="color:#ae81ff">128</span>;
        }
    }
}


<span style="color:#75715e">/// @title The facet of the CryptoKitties core contract that manages ownership, ERC-721 (draft) compliant.
</span><span style="color:#75715e">/// @author Axiom Zen (https://www.axiomzen.co)
</span><span style="color:#75715e">/// @dev Ref: https://github.com/ethereum/EIPs/issues/721
</span><span style="color:#75715e">///  See the KittyCore contract documentation to understand how the various contract facets are arranged.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">KittyOwnership</span> <span style="color:#66d9ef">is</span> KittyBase, ERC721 {

    <span style="color:#75715e">/// @notice Name and symbol of the non fungible token, as defined in ERC721.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CryptoKitties&#34;</span>;
    <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> symbol <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CK&#34;</span>;

    <span style="color:#75715e">// The contract that will return kitty metadata
</span><span style="color:#75715e"></span>    ERC721Metadata <span style="color:#66d9ef">public</span> erc721Metadata;

    <span style="color:#66d9ef">bytes4</span> <span style="color:#66d9ef">constant</span> InterfaceSignature_ERC165 <span style="color:#f92672">=</span>
        <span style="color:#66d9ef">bytes4</span>(keccak256(<span style="color:#e6db74">&#39;supportsInterface(bytes4)&#39;</span>));

    <span style="color:#66d9ef">bytes4</span> <span style="color:#66d9ef">constant</span> InterfaceSignature_ERC721 <span style="color:#f92672">=</span>
        <span style="color:#66d9ef">bytes4</span>(keccak256(<span style="color:#e6db74">&#39;name()&#39;</span>)) <span style="color:#f92672">^</span>
        <span style="color:#66d9ef">bytes4</span>(keccak256(<span style="color:#e6db74">&#39;symbol()&#39;</span>)) <span style="color:#f92672">^</span>
        <span style="color:#66d9ef">bytes4</span>(keccak256(<span style="color:#e6db74">&#39;totalSupply()&#39;</span>)) <span style="color:#f92672">^</span>
        <span style="color:#66d9ef">bytes4</span>(keccak256(<span style="color:#e6db74">&#39;balanceOf(address)&#39;</span>)) <span style="color:#f92672">^</span>
        <span style="color:#66d9ef">bytes4</span>(keccak256(<span style="color:#e6db74">&#39;ownerOf(uint256)&#39;</span>)) <span style="color:#f92672">^</span>
        <span style="color:#66d9ef">bytes4</span>(keccak256(<span style="color:#e6db74">&#39;approve(address,uint256)&#39;</span>)) <span style="color:#f92672">^</span>
        <span style="color:#66d9ef">bytes4</span>(keccak256(<span style="color:#e6db74">&#39;transfer(address,uint256)&#39;</span>)) <span style="color:#f92672">^</span>
        <span style="color:#66d9ef">bytes4</span>(keccak256(<span style="color:#e6db74">&#39;transferFrom(address,address,uint256)&#39;</span>)) <span style="color:#f92672">^</span>
        <span style="color:#66d9ef">bytes4</span>(keccak256(<span style="color:#e6db74">&#39;tokensOfOwner(address)&#39;</span>)) <span style="color:#f92672">^</span>
        <span style="color:#66d9ef">bytes4</span>(keccak256(<span style="color:#e6db74">&#39;tokenMetadata(uint256,string)&#39;</span>));

    <span style="color:#75715e">/// @notice Introspection interface as per ERC-165 (https://github.com/ethereum/EIPs/issues/165).
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  Returns true for any standardized interfaces implemented by this contract. We implement
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  ERC-165 (obviously!) and ERC-721.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">supportsInterface</span>(<span style="color:#66d9ef">bytes4</span> _interfaceID) <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>)
    {
        <span style="color:#75715e">// DEBUG ONLY
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//require((InterfaceSignature_ERC165 == 0x01ffc9a7) &amp;&amp; (InterfaceSignature_ERC721 == 0x9a20483d));
</span><span style="color:#75715e"></span>
        <span style="color:#66d9ef">return</span> ((_interfaceID <span style="color:#f92672">==</span> InterfaceSignature_ERC165) <span style="color:#f92672">||</span> (_interfaceID <span style="color:#f92672">==</span> InterfaceSignature_ERC721));
    }

    <span style="color:#75715e">/// @dev Set the address of the sibling contract that tracks metadata.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  CEO only.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setMetadataAddress</span>(<span style="color:#66d9ef">address</span> _contractAddress) <span style="color:#66d9ef">public</span> onlyCEO {
        erc721Metadata <span style="color:#f92672">=</span> ERC721Metadata(_contractAddress);
    }

    <span style="color:#75715e">// Internal utility functions: These functions all assume that their input arguments
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// are valid. We leave it to public methods to sanitize their inputs and follow
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// the required logic.
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">/// @dev Checks if a given address is the current owner of a particular Kitty.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _claimant the address we are validating against.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId kitten id, only valid when &gt; 0
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_owns</span>(<span style="color:#66d9ef">address</span> _claimant, <span style="color:#66d9ef">uint256</span> _tokenId) <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
        <span style="color:#66d9ef">return</span> kittyIndexToOwner[_tokenId] <span style="color:#f92672">==</span> _claimant;
    }

    <span style="color:#75715e">/// @dev Checks if a given address currently has transferApproval for a particular Kitty.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _claimant the address we are confirming kitten is approved for.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId kitten id, only valid when &gt; 0
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_approvedFor</span>(<span style="color:#66d9ef">address</span> _claimant, <span style="color:#66d9ef">uint256</span> _tokenId) <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
        <span style="color:#66d9ef">return</span> kittyIndexToApproved[_tokenId] <span style="color:#f92672">==</span> _claimant;
    }

    <span style="color:#75715e">/// @dev Marks an address as being approved for transferFrom(), overwriting any previous
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  approval. Setting _approved to address(0) clears all transfer approval.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  NOTE: _approve() does NOT send the Approval event. This is intentional because
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  _approve() and transferFrom() are used together for putting Kitties on auction, and
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  there is no value in spamming the log with Approval events in that case.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_approve</span>(<span style="color:#66d9ef">uint256</span> _tokenId, <span style="color:#66d9ef">address</span> _approved) <span style="color:#66d9ef">internal</span> {
        kittyIndexToApproved[_tokenId] <span style="color:#f92672">=</span> _approved;
    }

    <span style="color:#75715e">/// @notice Returns the number of Kitties owned by a specific address.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _owner The owner address to check.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @dev Required for ERC-721 compliance
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">balanceOf</span>(<span style="color:#66d9ef">address</span> _owner) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint256</span> count) {
        <span style="color:#66d9ef">return</span> ownershipTokenCount[_owner];
    }

    <span style="color:#75715e">/// @notice Transfers a Kitty to another address. If transferring to a smart
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  contract be VERY CAREFUL to ensure that it is aware of ERC-721 (or
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  CryptoKitties specifically) or your Kitty may be lost forever. Seriously.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _to The address of the recipient, can be a user or contract.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId The ID of the Kitty to transfer.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @dev Required for ERC-721 compliance.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">transfer</span>(
        <span style="color:#66d9ef">address</span> _to,
        <span style="color:#66d9ef">uint256</span> _tokenId
    )
        <span style="color:#66d9ef">external</span>
        whenNotPaused
    {
        <span style="color:#75715e">// Safety check to prevent against an unexpected 0x0 default.
</span><span style="color:#75715e"></span>        require(_to <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>));
        <span style="color:#75715e">// Disallow transfers to this contract to prevent accidental misuse.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// The contract should never own any kitties (except very briefly
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// after a gen0 cat is created and before it goes on auction).
</span><span style="color:#75715e"></span>        require(_to <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(this));
        <span style="color:#75715e">// Disallow transfers to the auction contracts to prevent accidental
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// misuse. Auction contracts should only take ownership of kitties
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// through the allow + transferFrom flow.
</span><span style="color:#75715e"></span>        require(_to <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(saleAuction));
        require(_to <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(siringAuction));

        <span style="color:#75715e">// You can only send your own cat.
</span><span style="color:#75715e"></span>        require(_owns(msg.sender, _tokenId));

        <span style="color:#75715e">// Reassign ownership, clear pending approvals, emit Transfer event.
</span><span style="color:#75715e"></span>        _transfer(msg.sender, _to, _tokenId);
    }

    <span style="color:#75715e">/// @notice Grant another address the right to transfer a specific Kitty via
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  transferFrom(). This is the preferred flow for transfering NFTs to contracts.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _to The address to be granted transfer approval. Pass address(0) to
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  clear all approvals.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId The ID of the Kitty that can be transferred if this call succeeds.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @dev Required for ERC-721 compliance.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">approve</span>(
        <span style="color:#66d9ef">address</span> _to,
        <span style="color:#66d9ef">uint256</span> _tokenId
    )
        <span style="color:#66d9ef">external</span>
        whenNotPaused
    {
        <span style="color:#75715e">// Only an owner can grant transfer approval.
</span><span style="color:#75715e"></span>        require(_owns(msg.sender, _tokenId));

        <span style="color:#75715e">// Register the approval (replacing any previous approval).
</span><span style="color:#75715e"></span>        _approve(_tokenId, _to);

        <span style="color:#75715e">// Emit approval event.
</span><span style="color:#75715e"></span>        Approval(msg.sender, _to, _tokenId);
    }

    <span style="color:#75715e">/// @notice Transfer a Kitty owned by another address, for which the calling address
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  has previously been granted transfer approval by the owner.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _from The address that owns the Kitty to be transfered.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _to The address that should take ownership of the Kitty. Can be any address,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  including the caller.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId The ID of the Kitty to be transferred.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @dev Required for ERC-721 compliance.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">transferFrom</span>(
        <span style="color:#66d9ef">address</span> _from,
        <span style="color:#66d9ef">address</span> _to,
        <span style="color:#66d9ef">uint256</span> _tokenId
    )
        <span style="color:#66d9ef">external</span>
        whenNotPaused
    {
        <span style="color:#75715e">// Safety check to prevent against an unexpected 0x0 default.
</span><span style="color:#75715e"></span>        require(_to <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>));
        <span style="color:#75715e">// Disallow transfers to this contract to prevent accidental misuse.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// The contract should never own any kitties (except very briefly
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// after a gen0 cat is created and before it goes on auction).
</span><span style="color:#75715e"></span>        require(_to <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(this));
        <span style="color:#75715e">// Check for approval and valid ownership
</span><span style="color:#75715e"></span>        require(_approvedFor(msg.sender, _tokenId));
        require(_owns(_from, _tokenId));

        <span style="color:#75715e">// Reassign ownership (also clears pending approvals and emits Transfer event).
</span><span style="color:#75715e"></span>        _transfer(_from, _to, _tokenId);
    }

    <span style="color:#75715e">/// @notice Returns the total number of Kitties currently in existence.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @dev Required for ERC-721 compliance.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">totalSupply</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
        <span style="color:#66d9ef">return</span> kitties.length <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
    }

    <span style="color:#75715e">/// @notice Returns the address currently assigned ownership of a given Kitty.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @dev Required for ERC-721 compliance.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">ownerOf</span>(<span style="color:#66d9ef">uint256</span> _tokenId)
        <span style="color:#66d9ef">external</span>
        <span style="color:#66d9ef">view</span>
        <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">address</span> owner)
    {
        owner <span style="color:#f92672">=</span> kittyIndexToOwner[_tokenId];

        require(owner <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>));
    }

    <span style="color:#75715e">/// @notice Returns a list of all Kitty IDs assigned to an address.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _owner The owner whose Kitties we are interested in.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @dev This method MUST NEVER be called by smart contract code. First, it&#39;s fairly
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  expensive (it walks the entire Kitty array looking for cats belonging to owner),
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  but it also returns a dynamic array, which is only supported for web3 calls, and
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  not contract-to-contract calls.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">tokensOfOwner</span>(<span style="color:#66d9ef">address</span> _owner) <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span>(<span style="color:#66d9ef">uint256</span>[] ownerTokens) {
        <span style="color:#66d9ef">uint256</span> tokenCount <span style="color:#f92672">=</span> balanceOf(_owner);

        <span style="color:#66d9ef">if</span> (tokenCount <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
            <span style="color:#75715e">// Return an empty array
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">uint256</span>[](<span style="color:#ae81ff">0</span>);
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#66d9ef">uint256</span>[] <span style="color:#66d9ef">memory</span> result <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">uint256</span>[](tokenCount);
            <span style="color:#66d9ef">uint256</span> totalCats <span style="color:#f92672">=</span> totalSupply();
            <span style="color:#66d9ef">uint256</span> resultIndex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

            <span style="color:#75715e">// We count on the fact that all cats have IDs starting at 1 and increasing
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// sequentially up to the totalCat count.
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">uint256</span> catId;

            <span style="color:#66d9ef">for</span> (catId <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; catId <span style="color:#f92672">&lt;=</span> totalCats; catId<span style="color:#f92672">++</span>) {
                <span style="color:#66d9ef">if</span> (kittyIndexToOwner[catId] <span style="color:#f92672">==</span> _owner) {
                    result[resultIndex] <span style="color:#f92672">=</span> catId;
                    resultIndex<span style="color:#f92672">++</span>;
                }
            }

            <span style="color:#66d9ef">return</span> result;
        }
    }

    <span style="color:#75715e">/// @dev Adapted from memcpy() by @arachnid (Nick Johnson &lt;arachnid@notdot.net&gt;)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  This method is licenced under the Apache License.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  Ref: https://github.com/Arachnid/solidity-stringutils/blob/2f6ca9accb48ae14c66f1437ec50ed19a0616f78/strings.sol
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_memcpy</span>(<span style="color:#66d9ef">uint</span> _dest, <span style="color:#66d9ef">uint</span> _src, <span style="color:#66d9ef">uint</span> _len) <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">view</span> {
        <span style="color:#75715e">// Copy word-length chunks while possible
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span>(; _len <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">32</span>; _len <span style="color:#f92672">-=</span> <span style="color:#ae81ff">32</span>) {
            <span style="color:#66d9ef">assembly</span> {
                <span style="color:#a6e22e">mstore</span>(_dest, <span style="color:#a6e22e">mload</span>(_src))
            }
            _dest <span style="color:#960050;background-color:#1e0010">+=</span> <span style="color:#ae81ff">32</span><span style="color:#960050;background-color:#1e0010">;</span>
            _src <span style="color:#960050;background-color:#1e0010">+=</span> <span style="color:#ae81ff">32</span><span style="color:#960050;background-color:#1e0010">;</span>
        }

        <span style="color:#75715e">// Copy remaining bytes
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint256</span> mask <span style="color:#f92672">=</span> <span style="color:#ae81ff">256</span> <span style="color:#f92672">**</span> (<span style="color:#ae81ff">32</span> <span style="color:#f92672">-</span> _len) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
        <span style="color:#66d9ef">assembly</span> {
            <span style="color:#f92672">let</span> srcpart <span style="color:#f92672">:=</span> <span style="color:#a6e22e">and</span>(<span style="color:#a6e22e">mload</span>(_src), <span style="color:#a6e22e">not</span>(mask))
            <span style="color:#f92672">let</span> destpart <span style="color:#f92672">:=</span> <span style="color:#a6e22e">and</span>(<span style="color:#a6e22e">mload</span>(_dest), mask)
            <span style="color:#a6e22e">mstore</span>(_dest, <span style="color:#a6e22e">or</span>(destpart, srcpart))
        }
    }

    <span style="color:#75715e">/// @dev Adapted from toString(slice) by @arachnid (Nick Johnson &lt;arachnid@notdot.net&gt;)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  This method is licenced under the Apache License.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  Ref: https://github.com/Arachnid/solidity-stringutils/blob/2f6ca9accb48ae14c66f1437ec50ed19a0616f78/strings.sol
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_toString</span>(<span style="color:#66d9ef">bytes32</span>[<span style="color:#ae81ff">4</span>] _rawBytes, <span style="color:#66d9ef">uint256</span> _stringLength) <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">string</span>) {
        <span style="color:#66d9ef">var</span> outputString <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">string</span>(_stringLength);
        <span style="color:#66d9ef">uint256</span> outputPtr;
        <span style="color:#66d9ef">uint256</span> bytesPtr;

        <span style="color:#66d9ef">assembly</span> {
            outputPtr <span style="color:#f92672">:=</span> <span style="color:#a6e22e">add</span>(outputString, <span style="color:#ae81ff">32</span>)
            bytesPtr <span style="color:#f92672">:=</span> _rawBytes
        }

        _memcpy(outputPtr, bytesPtr, _stringLength)<span style="color:#960050;background-color:#1e0010">;</span>

        <span style="color:#a6e22e">return</span> outputString<span style="color:#960050;background-color:#1e0010">;</span>
    }

    <span style="color:#75715e">/// @notice Returns a URI pointing to a metadata package for this token conforming to
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  ERC-721 (https://github.com/ethereum/EIPs/issues/721)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId The ID number of the Kitty whose metadata should be returned.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">tokenMetadata</span>(<span style="color:#66d9ef">uint256</span> _tokenId, <span style="color:#66d9ef">string</span> _preferredTransport) <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">string</span> infoUrl) {
        require(erc721Metadata <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>));
        <span style="color:#66d9ef">bytes32</span>[<span style="color:#ae81ff">4</span>] <span style="color:#66d9ef">memory</span> buffer;
        <span style="color:#66d9ef">uint256</span> count;
        (buffer, count) <span style="color:#f92672">=</span> erc721Metadata.getMetadata(_tokenId, _preferredTransport);

        <span style="color:#66d9ef">return</span> _toString(buffer, count);
    }
}



<span style="color:#75715e">/// @title A facet of KittyCore that manages Kitty siring, gestation, and birth.
</span><span style="color:#75715e">/// @author Axiom Zen (https://www.axiomzen.co)
</span><span style="color:#75715e">/// @dev See the KittyCore contract documentation to understand how the various contract facets are arranged.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">KittyBreeding</span> <span style="color:#66d9ef">is</span> KittyOwnership {

    <span style="color:#75715e">/// @dev The Pregnant event is fired when two cats successfully breed and the pregnancy
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  timer begins for the matron.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">Pregnant</span>(<span style="color:#66d9ef">address</span> owner, <span style="color:#66d9ef">uint256</span> matronId, <span style="color:#66d9ef">uint256</span> sireId, <span style="color:#66d9ef">uint256</span> cooldownEndBlock);

    <span style="color:#75715e">/// @notice The minimum payment required to use breedWithAuto(). This fee goes towards
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  the gas cost paid by whatever calls giveBirth(), and can be dynamically updated by
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  the COO role as the gas price changes.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint256</span> <span style="color:#66d9ef">public</span> autoBirthFee <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">finney</span>;

    <span style="color:#75715e">// Keeps track of number of pregnant kitties.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint256</span> <span style="color:#66d9ef">public</span> pregnantKitties;

    <span style="color:#75715e">/// @dev The address of the sibling contract that is used to implement the sooper-sekret
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  genetic combination algorithm.
</span><span style="color:#75715e"></span>    GeneScienceInterface <span style="color:#66d9ef">public</span> geneScience;

    <span style="color:#75715e">/// @dev Update the address of the genetic contract, can only be called by the CEO.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _address An address of a GeneScience contract instance to be used from this point forward.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setGeneScienceAddress</span>(<span style="color:#66d9ef">address</span> _address) <span style="color:#66d9ef">external</span> onlyCEO {
        GeneScienceInterface candidateContract <span style="color:#f92672">=</span> GeneScienceInterface(_address);

        <span style="color:#75715e">// NOTE: verify that a contract is what we expect - https://github.com/Lunyr/crowdsale-contracts/blob/cfadd15986c30521d8ba7d5b6f57b4fefcc7ac38/contracts/LunyrToken.sol#L117
</span><span style="color:#75715e"></span>        require(candidateContract.isGeneScience());

        <span style="color:#75715e">// Set the new contract address
</span><span style="color:#75715e"></span>        geneScience <span style="color:#f92672">=</span> candidateContract;
    }

    <span style="color:#75715e">/// @dev Checks that a given kitten is able to breed. Requires that the
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  current cooldown is finished (for sires) and also checks that there is
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  no pending pregnancy.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_isReadyToBreed</span>(Kitty _kit) <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
        <span style="color:#75715e">// In addition to checking the cooldownEndBlock, we also need to check to see if
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// the cat has a pending birth; there can be some period of time between the end
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// of the pregnacy timer and the birth event.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> (_kit.siringWithId <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">&amp;&amp;</span> (_kit.cooldownEndBlock <span style="color:#f92672">&lt;=</span> <span style="color:#66d9ef">uint64</span>(block.number));
    }

    <span style="color:#75715e">/// @dev Check if a sire has authorized breeding with this matron. True if both sire
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  and matron have the same owner, or if the sire has given siring permission to
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  the matron&#39;s owner (via approveSiring()).
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_isSiringPermitted</span>(<span style="color:#66d9ef">uint256</span> _sireId, <span style="color:#66d9ef">uint256</span> _matronId) <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
        <span style="color:#66d9ef">address</span> matronOwner <span style="color:#f92672">=</span> kittyIndexToOwner[_matronId];
        <span style="color:#66d9ef">address</span> sireOwner <span style="color:#f92672">=</span> kittyIndexToOwner[_sireId];

        <span style="color:#75715e">// Siring is okay if they have same owner, or if the matron&#39;s owner was given
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// permission to breed with this sire.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> (matronOwner <span style="color:#f92672">==</span> sireOwner <span style="color:#f92672">||</span> sireAllowedToAddress[_sireId] <span style="color:#f92672">==</span> matronOwner);
    }

    <span style="color:#75715e">/// @dev Set the cooldownEndTime for the given Kitty, based on its current cooldownIndex.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  Also increments the cooldownIndex (unless it has hit the cap).
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _kitten A reference to the Kitty in storage which needs its timer started.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_triggerCooldown</span>(Kitty <span style="color:#66d9ef">storage</span> _kitten) <span style="color:#66d9ef">internal</span> {
        <span style="color:#75715e">// Compute an estimation of the cooldown time in blocks (based on current cooldownIndex).
</span><span style="color:#75715e"></span>        _kitten.cooldownEndBlock <span style="color:#f92672">=</span> <span style="color:#66d9ef">uint64</span>((cooldowns[_kitten.cooldownIndex]<span style="color:#f92672">/</span>secondsPerBlock) <span style="color:#f92672">+</span> block.number);

        <span style="color:#75715e">// Increment the breeding count, clamping it at 13, which is the length of the
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// cooldowns array. We could check the array size dynamically, but hard-coding
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// this as a constant saves gas. Yay, Solidity!
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (_kitten.cooldownIndex <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">13</span>) {
            _kitten.cooldownIndex <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>;
        }
    }

    <span style="color:#75715e">/// @notice Grants approval to another user to sire with one of your Kitties.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _addr The address that will be able to sire with your Kitty. Set to
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  address(0) to clear all siring approvals for this Kitty.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _sireId A Kitty that you own that _addr will now be able to sire with.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">approveSiring</span>(<span style="color:#66d9ef">address</span> _addr, <span style="color:#66d9ef">uint256</span> _sireId)
        <span style="color:#66d9ef">external</span>
        whenNotPaused
    {
        require(_owns(msg.sender, _sireId));
        sireAllowedToAddress[_sireId] <span style="color:#f92672">=</span> _addr;
    }

    <span style="color:#75715e">/// @dev Updates the minimum payment required for calling giveBirthAuto(). Can only
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  be called by the COO address. (This fee is used to offset the gas cost incurred
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  by the autobirth daemon).
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setAutoBirthFee</span>(<span style="color:#66d9ef">uint256</span> val) <span style="color:#66d9ef">external</span> onlyCOO {
        autoBirthFee <span style="color:#f92672">=</span> val;
    }

    <span style="color:#75715e">/// @dev Checks to see if a given Kitty is pregnant and (if so) if the gestation
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  period has passed.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_isReadyToGiveBirth</span>(Kitty _matron) <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
        <span style="color:#66d9ef">return</span> (_matron.siringWithId <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">&amp;&amp;</span> (_matron.cooldownEndBlock <span style="color:#f92672">&lt;=</span> <span style="color:#66d9ef">uint64</span>(block.number));
    }

    <span style="color:#75715e">/// @notice Checks that a given kitten is able to breed (i.e. it is not pregnant or
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  in the middle of a siring cooldown).
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _kittyId reference the id of the kitten, any user can inquire about it
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isReadyToBreed</span>(<span style="color:#66d9ef">uint256</span> _kittyId)
        <span style="color:#66d9ef">public</span>
        <span style="color:#66d9ef">view</span>
        <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>)
    {
        require(_kittyId <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>);
        Kitty <span style="color:#66d9ef">storage</span> kit <span style="color:#f92672">=</span> kitties[_kittyId];
        <span style="color:#66d9ef">return</span> _isReadyToBreed(kit);
    }

    <span style="color:#75715e">/// @dev Checks whether a kitty is currently pregnant.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _kittyId reference the id of the kitten, any user can inquire about it
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isPregnant</span>(<span style="color:#66d9ef">uint256</span> _kittyId)
        <span style="color:#66d9ef">public</span>
        <span style="color:#66d9ef">view</span>
        <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>)
    {
        require(_kittyId <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>);
        <span style="color:#75715e">// A kitty is pregnant if and only if this field is set
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> kitties[_kittyId].siringWithId <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>;
    }

    <span style="color:#75715e">/// @dev Internal check to see if a given sire and matron are a valid mating pair. DOES NOT
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  check ownership permissions (that is up to the caller).
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _matron A reference to the Kitty struct of the potential matron.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _matronId The matron&#39;s ID.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _sire A reference to the Kitty struct of the potential sire.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _sireId The sire&#39;s ID
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_isValidMatingPair</span>(
        Kitty <span style="color:#66d9ef">storage</span> _matron,
        <span style="color:#66d9ef">uint256</span> _matronId,
        Kitty <span style="color:#66d9ef">storage</span> _sire,
        <span style="color:#66d9ef">uint256</span> _sireId
    )
        <span style="color:#66d9ef">private</span>
        <span style="color:#66d9ef">view</span>
        <span style="color:#66d9ef">returns</span>(<span style="color:#66d9ef">bool</span>)
    {
        <span style="color:#75715e">// A Kitty can&#39;t breed with itself!
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (_matronId <span style="color:#f92672">==</span> _sireId) {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
        }

        <span style="color:#75715e">// Kitties can&#39;t breed with their parents.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (_matron.matronId <span style="color:#f92672">==</span> _sireId <span style="color:#f92672">||</span> _matron.sireId <span style="color:#f92672">==</span> _sireId) {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
        }
        <span style="color:#66d9ef">if</span> (_sire.matronId <span style="color:#f92672">==</span> _matronId <span style="color:#f92672">||</span> _sire.sireId <span style="color:#f92672">==</span> _matronId) {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
        }

        <span style="color:#75715e">// We can short circuit the sibling check (below) if either cat is
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// gen zero (has a matron ID of zero).
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (_sire.matronId <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> _matron.matronId <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
        }

        <span style="color:#75715e">// Kitties can&#39;t breed with full or half siblings.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (_sire.matronId <span style="color:#f92672">==</span> _matron.matronId <span style="color:#f92672">||</span> _sire.matronId <span style="color:#f92672">==</span> _matron.sireId) {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
        }
        <span style="color:#66d9ef">if</span> (_sire.sireId <span style="color:#f92672">==</span> _matron.matronId <span style="color:#f92672">||</span> _sire.sireId <span style="color:#f92672">==</span> _matron.sireId) {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
        }

        <span style="color:#75715e">// Everything seems cool! Let&#39;s get DTF.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
    }

    <span style="color:#75715e">/// @dev Internal check to see if a given sire and matron are a valid mating pair for
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  breeding via auction (i.e. skips ownership and siring approval checks).
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_canBreedWithViaAuction</span>(<span style="color:#66d9ef">uint256</span> _matronId, <span style="color:#66d9ef">uint256</span> _sireId)
        <span style="color:#66d9ef">internal</span>
        <span style="color:#66d9ef">view</span>
        <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>)
    {
        Kitty <span style="color:#66d9ef">storage</span> matron <span style="color:#f92672">=</span> kitties[_matronId];
        Kitty <span style="color:#66d9ef">storage</span> sire <span style="color:#f92672">=</span> kitties[_sireId];
        <span style="color:#66d9ef">return</span> _isValidMatingPair(matron, _matronId, sire, _sireId);
    }

    <span style="color:#75715e">/// @notice Checks to see if two cats can breed together, including checks for
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  ownership and siring approvals. Does NOT check that both cats are ready for
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  breeding (i.e. breedWith could still fail until the cooldowns are finished).
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  TODO: Shouldn&#39;t this check pregnancy and cooldowns?!?
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _matronId The ID of the proposed matron.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _sireId The ID of the proposed sire.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">canBreedWith</span>(<span style="color:#66d9ef">uint256</span> _matronId, <span style="color:#66d9ef">uint256</span> _sireId)
        <span style="color:#66d9ef">external</span>
        <span style="color:#66d9ef">view</span>
        <span style="color:#66d9ef">returns</span>(<span style="color:#66d9ef">bool</span>)
    {
        require(_matronId <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>);
        require(_sireId <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>);
        Kitty <span style="color:#66d9ef">storage</span> matron <span style="color:#f92672">=</span> kitties[_matronId];
        Kitty <span style="color:#66d9ef">storage</span> sire <span style="color:#f92672">=</span> kitties[_sireId];
        <span style="color:#66d9ef">return</span> _isValidMatingPair(matron, _matronId, sire, _sireId) <span style="color:#f92672">&amp;&amp;</span>
            _isSiringPermitted(_sireId, _matronId);
    }

    <span style="color:#75715e">/// @dev Internal utility function to initiate breeding, assumes that all breeding
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  requirements have been checked.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_breedWith</span>(<span style="color:#66d9ef">uint256</span> _matronId, <span style="color:#66d9ef">uint256</span> _sireId) <span style="color:#66d9ef">internal</span> {
        <span style="color:#75715e">// Grab a reference to the Kitties from storage.
</span><span style="color:#75715e"></span>        Kitty <span style="color:#66d9ef">storage</span> sire <span style="color:#f92672">=</span> kitties[_sireId];
        Kitty <span style="color:#66d9ef">storage</span> matron <span style="color:#f92672">=</span> kitties[_matronId];

        <span style="color:#75715e">// Mark the matron as pregnant, keeping track of who the sire is.
</span><span style="color:#75715e"></span>        matron.siringWithId <span style="color:#f92672">=</span> <span style="color:#66d9ef">uint32</span>(_sireId);

        <span style="color:#75715e">// Trigger the cooldown for both parents.
</span><span style="color:#75715e"></span>        _triggerCooldown(sire);
        _triggerCooldown(matron);

        <span style="color:#75715e">// Clear siring permission for both parents. This may not be strictly necessary
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// but it&#39;s likely to avoid confusion!
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">delete</span> sireAllowedToAddress[_matronId];
        <span style="color:#66d9ef">delete</span> sireAllowedToAddress[_sireId];

        <span style="color:#75715e">// Every time a kitty gets pregnant, counter is incremented.
</span><span style="color:#75715e"></span>        pregnantKitties<span style="color:#f92672">++</span>;

        <span style="color:#75715e">// Emit the pregnancy event.
</span><span style="color:#75715e"></span>        Pregnant(kittyIndexToOwner[_matronId], _matronId, _sireId, matron.cooldownEndBlock);
    }

    <span style="color:#75715e">/// @notice Breed a Kitty you own (as matron) with a sire that you own, or for which you
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  have previously been given Siring approval. Will either make your cat pregnant, or will
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  fail entirely. Requires a pre-payment of the fee given out to the first caller of giveBirth()
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _matronId The ID of the Kitty acting as matron (will end up pregnant if successful)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _sireId The ID of the Kitty acting as sire (will begin its siring cooldown if successful)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">breedWithAuto</span>(<span style="color:#66d9ef">uint256</span> _matronId, <span style="color:#66d9ef">uint256</span> _sireId)
        <span style="color:#66d9ef">external</span>
        <span style="color:#66d9ef">payable</span>
        whenNotPaused
    {
        <span style="color:#75715e">// Checks for payment.
</span><span style="color:#75715e"></span>        require(msg.value <span style="color:#f92672">&gt;=</span> autoBirthFee);

        <span style="color:#75715e">// Caller must own the matron.
</span><span style="color:#75715e"></span>        require(_owns(msg.sender, _matronId));

        <span style="color:#75715e">// Neither sire nor matron are allowed to be on auction during a normal
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// breeding operation, but we don&#39;t need to check that explicitly.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// For matron: The caller of this function can&#39;t be the owner of the matron
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//   because the owner of a Kitty on auction is the auction house, and the
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//   auction house will never call breedWith().
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// For sire: Similarly, a sire on auction will be owned by the auction house
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//   and the act of transferring ownership will have cleared any oustanding
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//   siring approval.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Thus we don&#39;t need to spend gas explicitly checking to see if either cat
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// is on auction.
</span><span style="color:#75715e"></span>
        <span style="color:#75715e">// Check that matron and sire are both owned by caller, or that the sire
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// has given siring permission to caller (i.e. matron&#39;s owner).
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Will fail for _sireId = 0
</span><span style="color:#75715e"></span>        require(_isSiringPermitted(_sireId, _matronId));

        <span style="color:#75715e">// Grab a reference to the potential matron
</span><span style="color:#75715e"></span>        Kitty <span style="color:#66d9ef">storage</span> matron <span style="color:#f92672">=</span> kitties[_matronId];

        <span style="color:#75715e">// Make sure matron isn&#39;t pregnant, or in the middle of a siring cooldown
</span><span style="color:#75715e"></span>        require(_isReadyToBreed(matron));

        <span style="color:#75715e">// Grab a reference to the potential sire
</span><span style="color:#75715e"></span>        Kitty <span style="color:#66d9ef">storage</span> sire <span style="color:#f92672">=</span> kitties[_sireId];

        <span style="color:#75715e">// Make sure sire isn&#39;t pregnant, or in the middle of a siring cooldown
</span><span style="color:#75715e"></span>        require(_isReadyToBreed(sire));

        <span style="color:#75715e">// Test that these cats are a valid mating pair.
</span><span style="color:#75715e"></span>        require(_isValidMatingPair(
            matron,
            _matronId,
            sire,
            _sireId
        ));

        <span style="color:#75715e">// All checks passed, kitty gets pregnant!
</span><span style="color:#75715e"></span>        _breedWith(_matronId, _sireId);
    }

    <span style="color:#75715e">/// @notice Have a pregnant Kitty give birth!
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _matronId A Kitty ready to give birth.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @return The Kitty ID of the new kitten.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @dev Looks at a given Kitty and, if pregnant and if the gestation period has passed,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  combines the genes of the two parents to create a new kitten. The new Kitty is assigned
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  to the current owner of the matron. Upon successful completion, both the matron and the
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  new kitten will be ready to breed again. Note that anyone can call this function (if they
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  are willing to pay the gas!), but the new kitten always goes to the mother&#39;s owner.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">giveBirth</span>(<span style="color:#66d9ef">uint256</span> _matronId)
        <span style="color:#66d9ef">external</span>
        whenNotPaused
        <span style="color:#66d9ef">returns</span>(<span style="color:#66d9ef">uint256</span>)
    {
        <span style="color:#75715e">// Grab a reference to the matron in storage.
</span><span style="color:#75715e"></span>        Kitty <span style="color:#66d9ef">storage</span> matron <span style="color:#f92672">=</span> kitties[_matronId];

        <span style="color:#75715e">// Check that the matron is a valid cat.
</span><span style="color:#75715e"></span>        require(matron.birthTime <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>);

        <span style="color:#75715e">// Check that the matron is pregnant, and that its time has come!
</span><span style="color:#75715e"></span>        require(_isReadyToGiveBirth(matron));

        <span style="color:#75715e">// Grab a reference to the sire in storage.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint256</span> sireId <span style="color:#f92672">=</span> matron.siringWithId;
        Kitty <span style="color:#66d9ef">storage</span> sire <span style="color:#f92672">=</span> kitties[sireId];

        <span style="color:#75715e">// Determine the higher generation number of the two parents
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint16</span> parentGen <span style="color:#f92672">=</span> matron.generation;
        <span style="color:#66d9ef">if</span> (sire.generation <span style="color:#f92672">&gt;</span> matron.generation) {
            parentGen <span style="color:#f92672">=</span> sire.generation;
        }

        <span style="color:#75715e">// Call the sooper-sekret gene mixing operation.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint256</span> childGenes <span style="color:#f92672">=</span> geneScience.mixGenes(matron.genes, sire.genes, matron.cooldownEndBlock <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);

        <span style="color:#75715e">// Make the new kitten!
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">address</span> owner <span style="color:#f92672">=</span> kittyIndexToOwner[_matronId];
        <span style="color:#66d9ef">uint256</span> kittenId <span style="color:#f92672">=</span> _createKitty(_matronId, matron.siringWithId, parentGen <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, childGenes, owner);

        <span style="color:#75715e">// Clear the reference to sire from the matron (REQUIRED! Having siringWithId
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// set is what marks a matron as being pregnant.)
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">delete</span> matron.siringWithId;

        <span style="color:#75715e">// Every time a kitty gives birth counter is decremented.
</span><span style="color:#75715e"></span>        pregnantKitties<span style="color:#f92672">--</span>;

        <span style="color:#75715e">// Send the balance fee to the person who made birth happen.
</span><span style="color:#75715e"></span>        msg.sender.send(autoBirthFee);

        <span style="color:#75715e">// return the new kitten&#39;s ID
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> kittenId;
    }
}










<span style="color:#75715e">/// @title Auction Core
</span><span style="color:#75715e">/// @dev Contains models, variables, and internal methods for the auction.
</span><span style="color:#75715e">/// @notice We omit a fallback function to prevent accidental sends to this contract.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">ClockAuctionBase</span> {

    <span style="color:#75715e">// Represents an auction on an NFT
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Auction</span> {
        <span style="color:#75715e">// Current owner of NFT
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">address</span> seller;
        <span style="color:#75715e">// Price (in wei) at beginning of auction
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint128</span> startingPrice;
        <span style="color:#75715e">// Price (in wei) at end of auction
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint128</span> endingPrice;
        <span style="color:#75715e">// Duration (in seconds) of auction
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint64</span> duration;
        <span style="color:#75715e">// Time when auction started
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// NOTE: 0 if this auction has been concluded
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint64</span> startedAt;
    }

    <span style="color:#75715e">// Reference to contract tracking NFT ownership
</span><span style="color:#75715e"></span>    ERC721 <span style="color:#66d9ef">public</span> nonFungibleContract;

    <span style="color:#75715e">// Cut owner takes on each auction, measured in basis points (1/100 of a percent).
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Values 0-10,000 map to 0%-100%
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint256</span> <span style="color:#66d9ef">public</span> ownerCut;

    <span style="color:#75715e">// Map from token ID to their corresponding auction.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">mapping</span> (<span style="color:#66d9ef">uint256</span> <span style="color:#f92672">=&gt;</span> Auction) tokenIdToAuction;

    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">AuctionCreated</span>(<span style="color:#66d9ef">uint256</span> tokenId, <span style="color:#66d9ef">uint256</span> startingPrice, <span style="color:#66d9ef">uint256</span> endingPrice, <span style="color:#66d9ef">uint256</span> duration);
    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">AuctionSuccessful</span>(<span style="color:#66d9ef">uint256</span> tokenId, <span style="color:#66d9ef">uint256</span> totalPrice, <span style="color:#66d9ef">address</span> winner);
    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">AuctionCancelled</span>(<span style="color:#66d9ef">uint256</span> tokenId);

    <span style="color:#75715e">/// @dev Returns true if the claimant owns the token.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _claimant - Address claiming to own the token.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId - ID of token whose ownership to verify.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_owns</span>(<span style="color:#66d9ef">address</span> _claimant, <span style="color:#66d9ef">uint256</span> _tokenId) <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
        <span style="color:#66d9ef">return</span> (nonFungibleContract.ownerOf(_tokenId) <span style="color:#f92672">==</span> _claimant);
    }

    <span style="color:#75715e">/// @dev Escrows the NFT, assigning ownership to this contract.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// Throws if the escrow fails.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _owner - Current owner address of token to escrow.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId - ID of token whose approval to verify.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_escrow</span>(<span style="color:#66d9ef">address</span> _owner, <span style="color:#66d9ef">uint256</span> _tokenId) <span style="color:#66d9ef">internal</span> {
        <span style="color:#75715e">// it will throw if transfer fails
</span><span style="color:#75715e"></span>        nonFungibleContract.transferFrom(_owner, this, _tokenId);
    }

    <span style="color:#75715e">/// @dev Transfers an NFT owned by this contract to another address.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// Returns true if the transfer succeeds.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _receiver - Address to transfer NFT to.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId - ID of token to transfer.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_transfer</span>(<span style="color:#66d9ef">address</span> _receiver, <span style="color:#66d9ef">uint256</span> _tokenId) <span style="color:#66d9ef">internal</span> {
        <span style="color:#75715e">// it will throw if transfer fails
</span><span style="color:#75715e"></span>        nonFungibleContract.transfer(_receiver, _tokenId);
    }

    <span style="color:#75715e">/// @dev Adds an auction to the list of open auctions. Also fires the
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  AuctionCreated event.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId The ID of the token to be put on auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _auction Auction to add.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_addAuction</span>(<span style="color:#66d9ef">uint256</span> _tokenId, Auction _auction) <span style="color:#66d9ef">internal</span> {
        <span style="color:#75715e">// Require that all auctions have a duration of
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// at least one minute. (Keeps our math from getting hairy!)
</span><span style="color:#75715e"></span>        require(_auction.duration <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">minutes</span>);

        tokenIdToAuction[_tokenId] <span style="color:#f92672">=</span> _auction;

        AuctionCreated(
            <span style="color:#66d9ef">uint256</span>(_tokenId),
            <span style="color:#66d9ef">uint256</span>(_auction.startingPrice),
            <span style="color:#66d9ef">uint256</span>(_auction.endingPrice),
            <span style="color:#66d9ef">uint256</span>(_auction.duration)
        );
    }

    <span style="color:#75715e">/// @dev Cancels an auction unconditionally.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_cancelAuction</span>(<span style="color:#66d9ef">uint256</span> _tokenId, <span style="color:#66d9ef">address</span> _seller) <span style="color:#66d9ef">internal</span> {
        _removeAuction(_tokenId);
        _transfer(_seller, _tokenId);
        AuctionCancelled(_tokenId);
    }

    <span style="color:#75715e">/// @dev Computes the price and transfers winnings.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// Does NOT transfer ownership of token.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_bid</span>(<span style="color:#66d9ef">uint256</span> _tokenId, <span style="color:#66d9ef">uint256</span> _bidAmount)
        <span style="color:#66d9ef">internal</span>
        <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint256</span>)
    {
        <span style="color:#75715e">// Get a reference to the auction struct
</span><span style="color:#75715e"></span>        Auction <span style="color:#66d9ef">storage</span> auction <span style="color:#f92672">=</span> tokenIdToAuction[_tokenId];

        <span style="color:#75715e">// Explicitly check that this auction is currently live.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// (Because of how Ethereum mappings work, we can&#39;t just count
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// on the lookup above failing. An invalid _tokenId will just
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// return an auction object that is all zeros.)
</span><span style="color:#75715e"></span>        require(_isOnAuction(auction));

        <span style="color:#75715e">// Check that the bid is greater than or equal to the current price
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint256</span> price <span style="color:#f92672">=</span> _currentPrice(auction);
        require(_bidAmount <span style="color:#f92672">&gt;=</span> price);

        <span style="color:#75715e">// Grab a reference to the seller before the auction struct
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// gets deleted.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">address</span> seller <span style="color:#f92672">=</span> auction.seller;

        <span style="color:#75715e">// The bid is good! Remove the auction before sending the fees
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// to the sender so we can&#39;t have a reentrancy attack.
</span><span style="color:#75715e"></span>        _removeAuction(_tokenId);

        <span style="color:#75715e">// Transfer proceeds to seller (if there are any!)
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (price <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
            <span style="color:#75715e">// Calculate the auctioneer&#39;s cut.
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// (NOTE: _computeCut() is guaranteed to return a
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// value &lt;= price, so this subtraction can&#39;t go negative.)
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">uint256</span> auctioneerCut <span style="color:#f92672">=</span> _computeCut(price);
            <span style="color:#66d9ef">uint256</span> sellerProceeds <span style="color:#f92672">=</span> price <span style="color:#f92672">-</span> auctioneerCut;

            <span style="color:#75715e">// NOTE: Doing a transfer() in the middle of a complex
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// method like this is generally discouraged because of
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// reentrancy attacks and DoS attacks if the seller is
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// a contract with an invalid fallback function. We explicitly
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// guard against reentrancy attacks by removing the auction
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// before calling transfer(), and the only thing the seller
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// can DoS is the sale of their own asset! (And if it&#39;s an
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// accident, they can call cancelAuction(). )
</span><span style="color:#75715e"></span>            seller.transfer(sellerProceeds);
        }

        <span style="color:#75715e">// Calculate any excess funds included with the bid. If the excess
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// is anything worth worrying about, transfer it back to bidder.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// NOTE: We checked above that the bid amount is greater than or
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// equal to the price so this cannot underflow.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint256</span> bidExcess <span style="color:#f92672">=</span> _bidAmount <span style="color:#f92672">-</span> price;

        <span style="color:#75715e">// Return the funds. Similar to the previous transfer, this is
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// not susceptible to a re-entry attack because the auction is
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// removed before any transfers occur.
</span><span style="color:#75715e"></span>        msg.sender.transfer(bidExcess);

        <span style="color:#75715e">// Tell the world!
</span><span style="color:#75715e"></span>        AuctionSuccessful(_tokenId, price, msg.sender);

        <span style="color:#66d9ef">return</span> price;
    }

    <span style="color:#75715e">/// @dev Removes an auction from the list of open auctions.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId - ID of NFT on auction.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_removeAuction</span>(<span style="color:#66d9ef">uint256</span> _tokenId) <span style="color:#66d9ef">internal</span> {
        <span style="color:#66d9ef">delete</span> tokenIdToAuction[_tokenId];
    }

    <span style="color:#75715e">/// @dev Returns true if the NFT is on auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _auction - Auction to check.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_isOnAuction</span>(Auction <span style="color:#66d9ef">storage</span> _auction) <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
        <span style="color:#66d9ef">return</span> (_auction.startedAt <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>);
    }

    <span style="color:#75715e">/// @dev Returns current price of an NFT on auction. Broken into two
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  functions (this one, that computes the duration from the auction
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  structure, and the other that does the price computation) so we
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  can easily test that the price computation works correctly.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_currentPrice</span>(Auction <span style="color:#66d9ef">storage</span> _auction)
        <span style="color:#66d9ef">internal</span>
        <span style="color:#66d9ef">view</span>
        <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint256</span>)
    {
        <span style="color:#66d9ef">uint256</span> secondsPassed <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

        <span style="color:#75715e">// A bit of insurance against negative values (or wraparound).
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Probably not necessary (since Ethereum guarnatees that the
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// now variable doesn&#39;t ever go backwards).
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (now <span style="color:#f92672">&gt;</span> _auction.startedAt) {
            secondsPassed <span style="color:#f92672">=</span> now <span style="color:#f92672">-</span> _auction.startedAt;
        }

        <span style="color:#66d9ef">return</span> _computeCurrentPrice(
            _auction.startingPrice,
            _auction.endingPrice,
            _auction.duration,
            secondsPassed
        );
    }

    <span style="color:#75715e">/// @dev Computes the current price of an auction. Factored out
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  from _currentPrice so we can run extensive unit tests.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  When testing, make this function public and turn on
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  `Current price computation` test suite.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_computeCurrentPrice</span>(
        <span style="color:#66d9ef">uint256</span> _startingPrice,
        <span style="color:#66d9ef">uint256</span> _endingPrice,
        <span style="color:#66d9ef">uint256</span> _duration,
        <span style="color:#66d9ef">uint256</span> _secondsPassed
    )
        <span style="color:#66d9ef">internal</span>
        <span style="color:#66d9ef">pure</span>
        <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint256</span>)
    {
        <span style="color:#75715e">// NOTE: We don&#39;t use SafeMath (or similar) in this function because
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//  all of our public functions carefully cap the maximum values for
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//  time (at 64-bits) and currency (at 128-bits). _duration is
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//  also known to be non-zero (see the require() statement in
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//  _addAuction())
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (_secondsPassed <span style="color:#f92672">&gt;=</span> _duration) {
            <span style="color:#75715e">// We&#39;ve reached the end of the dynamic pricing portion
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// of the auction, just return the end price.
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> _endingPrice;
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#75715e">// Starting price can be higher than ending price (and often is!), so
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// this delta can be negative.
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">int256</span> totalPriceChange <span style="color:#f92672">=</span> <span style="color:#66d9ef">int256</span>(_endingPrice) <span style="color:#f92672">-</span> <span style="color:#66d9ef">int256</span>(_startingPrice);

            <span style="color:#75715e">// This multiplication can&#39;t overflow, _secondsPassed will easily fit within
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// 64-bits, and totalPriceChange will easily fit within 128-bits, their product
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// will always fit within 256-bits.
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">int256</span> currentPriceChange <span style="color:#f92672">=</span> totalPriceChange <span style="color:#f92672">*</span> <span style="color:#66d9ef">int256</span>(_secondsPassed) <span style="color:#f92672">/</span> <span style="color:#66d9ef">int256</span>(_duration);

            <span style="color:#75715e">// currentPriceChange can be negative, but if so, will have a magnitude
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// less that _startingPrice. Thus, this result will always end up positive.
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">int256</span> currentPrice <span style="color:#f92672">=</span> <span style="color:#66d9ef">int256</span>(_startingPrice) <span style="color:#f92672">+</span> currentPriceChange;

            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">uint256</span>(currentPrice);
        }
    }

    <span style="color:#75715e">/// @dev Computes owner&#39;s cut of a sale.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _price - Sale price of NFT.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_computeCut</span>(<span style="color:#66d9ef">uint256</span> _price) <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint256</span>) {
        <span style="color:#75715e">// NOTE: We don&#39;t use SafeMath (or similar) in this function because
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//  all of our entry functions carefully cap the maximum values for
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//  currency (at 128-bits), and ownerCut &lt;= 10000 (see the require()
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//  statement in the ClockAuction constructor). The result of this
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//  function is always guaranteed to be &lt;= _price.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> _price <span style="color:#f92672">*</span> ownerCut <span style="color:#f92672">/</span> <span style="color:#ae81ff">10000</span>;
    }

}







<span style="color:#75715e">/**
</span><span style="color:#75715e"> * @title Pausable
</span><span style="color:#75715e"> * @dev Base contract which allows children to implement an emergency stop mechanism.
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">Pausable</span> <span style="color:#66d9ef">is</span> Ownable {
  <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">Pause</span>();
  <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">Unpause</span>();

  <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">public</span> paused <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;


  <span style="color:#75715e">/**
</span><span style="color:#75715e">   * @dev modifier to allow actions only when the contract IS paused
</span><span style="color:#75715e">   */</span>
  <span style="color:#66d9ef">modifier</span> <span style="color:#a6e22e">whenNotPaused</span>() {
    require(<span style="color:#f92672">!</span>paused);
    <span style="color:#66d9ef">_</span>;
  }

  <span style="color:#75715e">/**
</span><span style="color:#75715e">   * @dev modifier to allow actions only when the contract IS NOT paused
</span><span style="color:#75715e">   */</span>
  <span style="color:#66d9ef">modifier</span> <span style="color:#a6e22e">whenPaused</span> {
    require(paused);
    <span style="color:#66d9ef">_</span>;
  }

  <span style="color:#75715e">/**
</span><span style="color:#75715e">   * @dev called by the owner to pause, triggers stopped state
</span><span style="color:#75715e">   */</span>
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">pause</span>() onlyOwner whenNotPaused <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
    paused <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
    Pause();
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
  }

  <span style="color:#75715e">/**
</span><span style="color:#75715e">   * @dev called by the owner to unpause, returns to normal state
</span><span style="color:#75715e">   */</span>
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">unpause</span>() onlyOwner whenPaused <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
    paused <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
    Unpause();
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
  }
}


<span style="color:#75715e">/// @title Clock auction for non-fungible tokens.
</span><span style="color:#75715e">/// @notice We omit a fallback function to prevent accidental sends to this contract.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">ClockAuction</span> <span style="color:#66d9ef">is</span> Pausable, ClockAuctionBase {

    <span style="color:#75715e">/// @dev The ERC-165 interface signature for ERC-721.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  Ref: https://github.com/ethereum/EIPs/issues/165
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  Ref: https://github.com/ethereum/EIPs/issues/721
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">bytes4</span> <span style="color:#66d9ef">constant</span> InterfaceSignature_ERC721 <span style="color:#f92672">=</span> <span style="color:#66d9ef">bytes4</span>(<span style="color:#ae81ff">0x9a20483d</span>);

    <span style="color:#75715e">/// @dev Constructor creates a reference to the NFT ownership contract
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  and verifies the owner cut is in the valid range.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _nftAddress - address of a deployed contract implementing
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  the Nonfungible Interface.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _cut - percent cut the owner takes on each auction, must be
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  between 0-10,000.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">ClockAuction</span>(<span style="color:#66d9ef">address</span> _nftAddress, <span style="color:#66d9ef">uint256</span> _cut) <span style="color:#66d9ef">public</span> {
        require(_cut <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">10000</span>);
        ownerCut <span style="color:#f92672">=</span> _cut;

        ERC721 candidateContract <span style="color:#f92672">=</span> ERC721(_nftAddress);
        require(candidateContract.supportsInterface(InterfaceSignature_ERC721));
        nonFungibleContract <span style="color:#f92672">=</span> candidateContract;
    }

    <span style="color:#75715e">/// @dev Remove all Ether from the contract, which is the owner&#39;s cuts
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  as well as any Ether sent directly to the contract address.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  Always transfers to the NFT contract, but can be called either by
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  the owner or the NFT contract.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">withdrawBalance</span>() <span style="color:#66d9ef">external</span> {
        <span style="color:#66d9ef">address</span> nftAddress <span style="color:#f92672">=</span> <span style="color:#66d9ef">address</span>(nonFungibleContract);

        require(
            msg.sender <span style="color:#f92672">==</span> owner <span style="color:#f92672">||</span>
            msg.sender <span style="color:#f92672">==</span> nftAddress
        );
        <span style="color:#75715e">// We are using this boolean method to make sure that even if one fails it will still work
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">bool</span> res <span style="color:#f92672">=</span> nftAddress.send(this.balance);
    }

    <span style="color:#75715e">/// @dev Creates and begins a new auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId - ID of token to auction, sender must be owner.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _startingPrice - Price of item (in wei) at beginning of auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _endingPrice - Price of item (in wei) at end of auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _duration - Length of time to move between starting
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  price and ending price (in seconds).
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _seller - Seller, if not the message sender
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createAuction</span>(
        <span style="color:#66d9ef">uint256</span> _tokenId,
        <span style="color:#66d9ef">uint256</span> _startingPrice,
        <span style="color:#66d9ef">uint256</span> _endingPrice,
        <span style="color:#66d9ef">uint256</span> _duration,
        <span style="color:#66d9ef">address</span> _seller
    )
        <span style="color:#66d9ef">external</span>
        whenNotPaused
    {
        <span style="color:#75715e">// Sanity check that no inputs overflow how many bits we&#39;ve allocated
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// to store them in the auction struct.
</span><span style="color:#75715e"></span>        require(_startingPrice <span style="color:#f92672">==</span> <span style="color:#66d9ef">uint256</span>(<span style="color:#66d9ef">uint128</span>(_startingPrice)));
        require(_endingPrice <span style="color:#f92672">==</span> <span style="color:#66d9ef">uint256</span>(<span style="color:#66d9ef">uint128</span>(_endingPrice)));
        require(_duration <span style="color:#f92672">==</span> <span style="color:#66d9ef">uint256</span>(<span style="color:#66d9ef">uint64</span>(_duration)));

        require(_owns(msg.sender, _tokenId));
        _escrow(msg.sender, _tokenId);
        Auction <span style="color:#66d9ef">memory</span> auction <span style="color:#f92672">=</span> Auction(
            _seller,
            <span style="color:#66d9ef">uint128</span>(_startingPrice),
            <span style="color:#66d9ef">uint128</span>(_endingPrice),
            <span style="color:#66d9ef">uint64</span>(_duration),
            <span style="color:#66d9ef">uint64</span>(now)
        );
        _addAuction(_tokenId, auction);
    }

    <span style="color:#75715e">/// @dev Bids on an open auction, completing the auction and transferring
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  ownership of the NFT if enough Ether is supplied.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId - ID of token to bid on.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">bid</span>(<span style="color:#66d9ef">uint256</span> _tokenId)
        <span style="color:#66d9ef">external</span>
        <span style="color:#66d9ef">payable</span>
        whenNotPaused
    {
        <span style="color:#75715e">// _bid will throw if the bid or funds transfer fails
</span><span style="color:#75715e"></span>        _bid(_tokenId, msg.value);
        _transfer(msg.sender, _tokenId);
    }

    <span style="color:#75715e">/// @dev Cancels an auction that hasn&#39;t been won yet.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  Returns the NFT to original owner.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @notice This is a state-modifying function that can
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  be called while the contract is paused.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId - ID of token on auction
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">cancelAuction</span>(<span style="color:#66d9ef">uint256</span> _tokenId)
        <span style="color:#66d9ef">external</span>
    {
        Auction <span style="color:#66d9ef">storage</span> auction <span style="color:#f92672">=</span> tokenIdToAuction[_tokenId];
        require(_isOnAuction(auction));
        <span style="color:#66d9ef">address</span> seller <span style="color:#f92672">=</span> auction.seller;
        require(msg.sender <span style="color:#f92672">==</span> seller);
        _cancelAuction(_tokenId, seller);
    }

    <span style="color:#75715e">/// @dev Cancels an auction when the contract is paused.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  Only the owner may do this, and NFTs are returned to
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  the seller. This should only be used in emergencies.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId - ID of the NFT on auction to cancel.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">cancelAuctionWhenPaused</span>(<span style="color:#66d9ef">uint256</span> _tokenId)
        whenPaused
        onlyOwner
        <span style="color:#66d9ef">external</span>
    {
        Auction <span style="color:#66d9ef">storage</span> auction <span style="color:#f92672">=</span> tokenIdToAuction[_tokenId];
        require(_isOnAuction(auction));
        _cancelAuction(_tokenId, auction.seller);
    }

    <span style="color:#75715e">/// @dev Returns auction info for an NFT on auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId - ID of NFT on auction.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getAuction</span>(<span style="color:#66d9ef">uint256</span> _tokenId)
        <span style="color:#66d9ef">external</span>
        <span style="color:#66d9ef">view</span>
        <span style="color:#66d9ef">returns</span>
    (
        <span style="color:#66d9ef">address</span> seller,
        <span style="color:#66d9ef">uint256</span> startingPrice,
        <span style="color:#66d9ef">uint256</span> endingPrice,
        <span style="color:#66d9ef">uint256</span> duration,
        <span style="color:#66d9ef">uint256</span> startedAt
    ) {
        Auction <span style="color:#66d9ef">storage</span> auction <span style="color:#f92672">=</span> tokenIdToAuction[_tokenId];
        require(_isOnAuction(auction));
        <span style="color:#66d9ef">return</span> (
            auction.seller,
            auction.startingPrice,
            auction.endingPrice,
            auction.duration,
            auction.startedAt
        );
    }

    <span style="color:#75715e">/// @dev Returns the current price of an auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId - ID of the token price we are checking.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getCurrentPrice</span>(<span style="color:#66d9ef">uint256</span> _tokenId)
        <span style="color:#66d9ef">external</span>
        <span style="color:#66d9ef">view</span>
        <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint256</span>)
    {
        Auction <span style="color:#66d9ef">storage</span> auction <span style="color:#f92672">=</span> tokenIdToAuction[_tokenId];
        require(_isOnAuction(auction));
        <span style="color:#66d9ef">return</span> _currentPrice(auction);
    }

}


<span style="color:#75715e">/// @title Reverse auction modified for siring
</span><span style="color:#75715e">/// @notice We omit a fallback function to prevent accidental sends to this contract.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">SiringClockAuction</span> <span style="color:#66d9ef">is</span> ClockAuction {

    <span style="color:#75715e">// @dev Sanity check that allows us to ensure that we are pointing to the
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//  right auction in our setSiringAuctionAddress() call.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">public</span> isSiringClockAuction <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;

    <span style="color:#75715e">// Delegate constructor
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">SiringClockAuction</span>(<span style="color:#66d9ef">address</span> _nftAddr, <span style="color:#66d9ef">uint256</span> _cut) <span style="color:#66d9ef">public</span>
        ClockAuction(_nftAddr, _cut) {}

    <span style="color:#75715e">/// @dev Creates and begins a new auction. Since this function is wrapped,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// require sender to be KittyCore contract.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId - ID of token to auction, sender must be owner.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _startingPrice - Price of item (in wei) at beginning of auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _endingPrice - Price of item (in wei) at end of auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _duration - Length of auction (in seconds).
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _seller - Seller, if not the message sender
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createAuction</span>(
        <span style="color:#66d9ef">uint256</span> _tokenId,
        <span style="color:#66d9ef">uint256</span> _startingPrice,
        <span style="color:#66d9ef">uint256</span> _endingPrice,
        <span style="color:#66d9ef">uint256</span> _duration,
        <span style="color:#66d9ef">address</span> _seller
    )
        <span style="color:#66d9ef">external</span>
    {
        <span style="color:#75715e">// Sanity check that no inputs overflow how many bits we&#39;ve allocated
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// to store them in the auction struct.
</span><span style="color:#75715e"></span>        require(_startingPrice <span style="color:#f92672">==</span> <span style="color:#66d9ef">uint256</span>(<span style="color:#66d9ef">uint128</span>(_startingPrice)));
        require(_endingPrice <span style="color:#f92672">==</span> <span style="color:#66d9ef">uint256</span>(<span style="color:#66d9ef">uint128</span>(_endingPrice)));
        require(_duration <span style="color:#f92672">==</span> <span style="color:#66d9ef">uint256</span>(<span style="color:#66d9ef">uint64</span>(_duration)));

        require(msg.sender <span style="color:#f92672">==</span> <span style="color:#66d9ef">address</span>(nonFungibleContract));
        _escrow(_seller, _tokenId);
        Auction <span style="color:#66d9ef">memory</span> auction <span style="color:#f92672">=</span> Auction(
            _seller,
            <span style="color:#66d9ef">uint128</span>(_startingPrice),
            <span style="color:#66d9ef">uint128</span>(_endingPrice),
            <span style="color:#66d9ef">uint64</span>(_duration),
            <span style="color:#66d9ef">uint64</span>(now)
        );
        _addAuction(_tokenId, auction);
    }

    <span style="color:#75715e">/// @dev Places a bid for siring. Requires the sender
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// is the KittyCore contract because all bid methods
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// should be wrapped. Also returns the kitty to the
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// seller rather than the winner.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">bid</span>(<span style="color:#66d9ef">uint256</span> _tokenId)
        <span style="color:#66d9ef">external</span>
        <span style="color:#66d9ef">payable</span>
    {
        require(msg.sender <span style="color:#f92672">==</span> <span style="color:#66d9ef">address</span>(nonFungibleContract));
        <span style="color:#66d9ef">address</span> seller <span style="color:#f92672">=</span> tokenIdToAuction[_tokenId].seller;
        <span style="color:#75715e">// _bid checks that token ID is valid and will throw if bid fails
</span><span style="color:#75715e"></span>        _bid(_tokenId, msg.value);
        <span style="color:#75715e">// We transfer the kitty back to the seller, the winner will get
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// the offspring
</span><span style="color:#75715e"></span>        _transfer(seller, _tokenId);
    }

}





<span style="color:#75715e">/// @title Clock auction modified for sale of kitties
</span><span style="color:#75715e">/// @notice We omit a fallback function to prevent accidental sends to this contract.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">SaleClockAuction</span> <span style="color:#66d9ef">is</span> ClockAuction {

    <span style="color:#75715e">// @dev Sanity check that allows us to ensure that we are pointing to the
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//  right auction in our setSaleAuctionAddress() call.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">public</span> isSaleClockAuction <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;

    <span style="color:#75715e">// Tracks last 5 sale price of gen0 kitty sales
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint256</span> <span style="color:#66d9ef">public</span> gen0SaleCount;
    <span style="color:#66d9ef">uint256</span>[<span style="color:#ae81ff">5</span>] <span style="color:#66d9ef">public</span> lastGen0SalePrices;

    <span style="color:#75715e">// Delegate constructor
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">SaleClockAuction</span>(<span style="color:#66d9ef">address</span> _nftAddr, <span style="color:#66d9ef">uint256</span> _cut) <span style="color:#66d9ef">public</span>
        ClockAuction(_nftAddr, _cut) {}

    <span style="color:#75715e">/// @dev Creates and begins a new auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _tokenId - ID of token to auction, sender must be owner.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _startingPrice - Price of item (in wei) at beginning of auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _endingPrice - Price of item (in wei) at end of auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _duration - Length of auction (in seconds).
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _seller - Seller, if not the message sender
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createAuction</span>(
        <span style="color:#66d9ef">uint256</span> _tokenId,
        <span style="color:#66d9ef">uint256</span> _startingPrice,
        <span style="color:#66d9ef">uint256</span> _endingPrice,
        <span style="color:#66d9ef">uint256</span> _duration,
        <span style="color:#66d9ef">address</span> _seller
    )
        <span style="color:#66d9ef">external</span>
    {
        <span style="color:#75715e">// Sanity check that no inputs overflow how many bits we&#39;ve allocated
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// to store them in the auction struct.
</span><span style="color:#75715e"></span>        require(_startingPrice <span style="color:#f92672">==</span> <span style="color:#66d9ef">uint256</span>(<span style="color:#66d9ef">uint128</span>(_startingPrice)));
        require(_endingPrice <span style="color:#f92672">==</span> <span style="color:#66d9ef">uint256</span>(<span style="color:#66d9ef">uint128</span>(_endingPrice)));
        require(_duration <span style="color:#f92672">==</span> <span style="color:#66d9ef">uint256</span>(<span style="color:#66d9ef">uint64</span>(_duration)));

        require(msg.sender <span style="color:#f92672">==</span> <span style="color:#66d9ef">address</span>(nonFungibleContract));
        _escrow(_seller, _tokenId);
        Auction <span style="color:#66d9ef">memory</span> auction <span style="color:#f92672">=</span> Auction(
            _seller,
            <span style="color:#66d9ef">uint128</span>(_startingPrice),
            <span style="color:#66d9ef">uint128</span>(_endingPrice),
            <span style="color:#66d9ef">uint64</span>(_duration),
            <span style="color:#66d9ef">uint64</span>(now)
        );
        _addAuction(_tokenId, auction);
    }

    <span style="color:#75715e">/// @dev Updates lastSalePrice if seller is the nft contract
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// Otherwise, works the same as default bid method.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">bid</span>(<span style="color:#66d9ef">uint256</span> _tokenId)
        <span style="color:#66d9ef">external</span>
        <span style="color:#66d9ef">payable</span>
    {
        <span style="color:#75715e">// _bid verifies token ID size
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">address</span> seller <span style="color:#f92672">=</span> tokenIdToAuction[_tokenId].seller;
        <span style="color:#66d9ef">uint256</span> price <span style="color:#f92672">=</span> _bid(_tokenId, msg.value);
        _transfer(msg.sender, _tokenId);

        <span style="color:#75715e">// If not a gen0 auction, exit
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (seller <span style="color:#f92672">==</span> <span style="color:#66d9ef">address</span>(nonFungibleContract)) {
            <span style="color:#75715e">// Track gen0 sale prices
</span><span style="color:#75715e"></span>            lastGen0SalePrices[gen0SaleCount <span style="color:#f92672">%</span> <span style="color:#ae81ff">5</span>] <span style="color:#f92672">=</span> price;
            gen0SaleCount<span style="color:#f92672">++</span>;
        }
    }

    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">averageGen0SalePrice</span>() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint256</span>) {
        <span style="color:#66d9ef">uint256</span> sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">uint256</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">5</span>; i<span style="color:#f92672">++</span>) {
            sum <span style="color:#f92672">+=</span> lastGen0SalePrices[i];
        }
        <span style="color:#66d9ef">return</span> sum <span style="color:#f92672">/</span> <span style="color:#ae81ff">5</span>;
    }

}


<span style="color:#75715e">/// @title Handles creating auctions for sale and siring of kitties.
</span><span style="color:#75715e">///  This wrapper of ReverseAuction exists only so that users can create
</span><span style="color:#75715e">///  auctions with only one transaction.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">KittyAuction</span> <span style="color:#66d9ef">is</span> KittyBreeding {

    <span style="color:#75715e">// @notice The auction contract variables are defined in KittyBase to allow
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//  us to refer to them in KittyOwnership to prevent accidental transfers.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// `saleAuction` refers to the auction for gen0 and p2p sale of kitties.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// `siringAuction` refers to the auction for siring rights of kitties.
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">/// @dev Sets the reference to the sale auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _address - Address of sale contract.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setSaleAuctionAddress</span>(<span style="color:#66d9ef">address</span> _address) <span style="color:#66d9ef">external</span> onlyCEO {
        SaleClockAuction candidateContract <span style="color:#f92672">=</span> SaleClockAuction(_address);

        <span style="color:#75715e">// NOTE: verify that a contract is what we expect - https://github.com/Lunyr/crowdsale-contracts/blob/cfadd15986c30521d8ba7d5b6f57b4fefcc7ac38/contracts/LunyrToken.sol#L117
</span><span style="color:#75715e"></span>        require(candidateContract.isSaleClockAuction());

        <span style="color:#75715e">// Set the new contract address
</span><span style="color:#75715e"></span>        saleAuction <span style="color:#f92672">=</span> candidateContract;
    }

    <span style="color:#75715e">/// @dev Sets the reference to the siring auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _address - Address of siring contract.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setSiringAuctionAddress</span>(<span style="color:#66d9ef">address</span> _address) <span style="color:#66d9ef">external</span> onlyCEO {
        SiringClockAuction candidateContract <span style="color:#f92672">=</span> SiringClockAuction(_address);

        <span style="color:#75715e">// NOTE: verify that a contract is what we expect - https://github.com/Lunyr/crowdsale-contracts/blob/cfadd15986c30521d8ba7d5b6f57b4fefcc7ac38/contracts/LunyrToken.sol#L117
</span><span style="color:#75715e"></span>        require(candidateContract.isSiringClockAuction());

        <span style="color:#75715e">// Set the new contract address
</span><span style="color:#75715e"></span>        siringAuction <span style="color:#f92672">=</span> candidateContract;
    }

    <span style="color:#75715e">/// @dev Put a kitty up for auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  Does some ownership trickery to create auctions in one tx.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createSaleAuction</span>(
        <span style="color:#66d9ef">uint256</span> _kittyId,
        <span style="color:#66d9ef">uint256</span> _startingPrice,
        <span style="color:#66d9ef">uint256</span> _endingPrice,
        <span style="color:#66d9ef">uint256</span> _duration
    )
        <span style="color:#66d9ef">external</span>
        whenNotPaused
    {
        <span style="color:#75715e">// Auction contract checks input sizes
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// If kitty is already on any auction, this will throw
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// because it will be owned by the auction contract.
</span><span style="color:#75715e"></span>        require(_owns(msg.sender, _kittyId));
        <span style="color:#75715e">// Ensure the kitty is not pregnant to prevent the auction
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// contract accidentally receiving ownership of the child.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// NOTE: the kitty IS allowed to be in a cooldown.
</span><span style="color:#75715e"></span>        require(<span style="color:#f92672">!</span>isPregnant(_kittyId));
        _approve(_kittyId, saleAuction);
        <span style="color:#75715e">// Sale auction throws if inputs are invalid and clears
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// transfer and sire approval after escrowing the kitty.
</span><span style="color:#75715e"></span>        saleAuction.createAuction(
            _kittyId,
            _startingPrice,
            _endingPrice,
            _duration,
            msg.sender
        );
    }

    <span style="color:#75715e">/// @dev Put a kitty up for auction to be sire.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  Performs checks to ensure the kitty can be sired, then
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  delegates to reverse auction.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createSiringAuction</span>(
        <span style="color:#66d9ef">uint256</span> _kittyId,
        <span style="color:#66d9ef">uint256</span> _startingPrice,
        <span style="color:#66d9ef">uint256</span> _endingPrice,
        <span style="color:#66d9ef">uint256</span> _duration
    )
        <span style="color:#66d9ef">external</span>
        whenNotPaused
    {
        <span style="color:#75715e">// Auction contract checks input sizes
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// If kitty is already on any auction, this will throw
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// because it will be owned by the auction contract.
</span><span style="color:#75715e"></span>        require(_owns(msg.sender, _kittyId));
        require(isReadyToBreed(_kittyId));
        _approve(_kittyId, siringAuction);
        <span style="color:#75715e">// Siring auction throws if inputs are invalid and clears
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// transfer and sire approval after escrowing the kitty.
</span><span style="color:#75715e"></span>        siringAuction.createAuction(
            _kittyId,
            _startingPrice,
            _endingPrice,
            _duration,
            msg.sender
        );
    }

    <span style="color:#75715e">/// @dev Completes a siring auction by bidding.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  Immediately breeds the winning matron with the sire on auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _sireId - ID of the sire on auction.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _matronId - ID of the matron owned by the bidder.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">bidOnSiringAuction</span>(
        <span style="color:#66d9ef">uint256</span> _sireId,
        <span style="color:#66d9ef">uint256</span> _matronId
    )
        <span style="color:#66d9ef">external</span>
        <span style="color:#66d9ef">payable</span>
        whenNotPaused
    {
        <span style="color:#75715e">// Auction contract checks input sizes
</span><span style="color:#75715e"></span>        require(_owns(msg.sender, _matronId));
        require(isReadyToBreed(_matronId));
        require(_canBreedWithViaAuction(_matronId, _sireId));

        <span style="color:#75715e">// Define the current price of the auction.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint256</span> currentPrice <span style="color:#f92672">=</span> siringAuction.getCurrentPrice(_sireId);
        require(msg.value <span style="color:#f92672">&gt;=</span> currentPrice <span style="color:#f92672">+</span> autoBirthFee);

        <span style="color:#75715e">// Siring auction will throw if the bid fails.
</span><span style="color:#75715e"></span>        siringAuction.bid.value(msg.value <span style="color:#f92672">-</span> autoBirthFee)(_sireId);
        _breedWith(<span style="color:#66d9ef">uint32</span>(_matronId), <span style="color:#66d9ef">uint32</span>(_sireId));
    }

    <span style="color:#75715e">/// @dev Transfers the balance of the sale auction contract
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// to the KittyCore contract. We use two-step withdrawal to
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// prevent two transfer calls in the auction bid function.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">withdrawAuctionBalances</span>() <span style="color:#66d9ef">external</span> onlyCLevel {
        saleAuction.withdrawBalance();
        siringAuction.withdrawBalance();
    }
}


<span style="color:#75715e">/// @title all functions related to creating kittens
</span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">KittyMinting</span> <span style="color:#66d9ef">is</span> KittyAuction {

    <span style="color:#75715e">// Limits the number of cats the contract owner can ever create.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint256</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> PROMO_CREATION_LIMIT <span style="color:#f92672">=</span> <span style="color:#ae81ff">5000</span>;
    <span style="color:#66d9ef">uint256</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> GEN0_CREATION_LIMIT <span style="color:#f92672">=</span> <span style="color:#ae81ff">45000</span>;

    <span style="color:#75715e">// Constants for gen0 auctions.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint256</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> GEN0_STARTING_PRICE <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span> <span style="color:#66d9ef">finney</span>;
    <span style="color:#66d9ef">uint256</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> GEN0_AUCTION_DURATION <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">days</span>;

    <span style="color:#75715e">// Counts the number of cats the contract owner has created.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint256</span> <span style="color:#66d9ef">public</span> promoCreatedCount;
    <span style="color:#66d9ef">uint256</span> <span style="color:#66d9ef">public</span> gen0CreatedCount;

    <span style="color:#75715e">/// @dev we can create promo kittens, up to a limit. Only callable by COO
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _genes the encoded genes of the kitten to be created, any value is accepted
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _owner the future owner of the created kittens. Default to contract COO
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createPromoKitty</span>(<span style="color:#66d9ef">uint256</span> _genes, <span style="color:#66d9ef">address</span> _owner) <span style="color:#66d9ef">external</span> onlyCOO {
        <span style="color:#66d9ef">address</span> kittyOwner <span style="color:#f92672">=</span> _owner;
        <span style="color:#66d9ef">if</span> (kittyOwner <span style="color:#f92672">==</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>)) {
             kittyOwner <span style="color:#f92672">=</span> cooAddress;
        }
        require(promoCreatedCount <span style="color:#f92672">&lt;</span> PROMO_CREATION_LIMIT);

        promoCreatedCount<span style="color:#f92672">++</span>;
        _createKitty(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, _genes, kittyOwner);
    }

    <span style="color:#75715e">/// @dev Creates a new gen0 kitty with the given genes and
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  creates an auction for it.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createGen0Auction</span>(<span style="color:#66d9ef">uint256</span> _genes) <span style="color:#66d9ef">external</span> onlyCOO {
        require(gen0CreatedCount <span style="color:#f92672">&lt;</span> GEN0_CREATION_LIMIT);

        <span style="color:#66d9ef">uint256</span> kittyId <span style="color:#f92672">=</span> _createKitty(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, _genes, <span style="color:#66d9ef">address</span>(this));
        _approve(kittyId, saleAuction);

        saleAuction.createAuction(
            kittyId,
            _computeNextGen0Price(),
            <span style="color:#ae81ff">0</span>,
            GEN0_AUCTION_DURATION,
            <span style="color:#66d9ef">address</span>(this)
        );

        gen0CreatedCount<span style="color:#f92672">++</span>;
    }

    <span style="color:#75715e">/// @dev Computes the next gen0 auction starting price, given
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  the average of the past 5 prices + 50%.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_computeNextGen0Price</span>() <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint256</span>) {
        <span style="color:#66d9ef">uint256</span> avePrice <span style="color:#f92672">=</span> saleAuction.averageGen0SalePrice();

        <span style="color:#75715e">// Sanity check to ensure we don&#39;t overflow arithmetic
</span><span style="color:#75715e"></span>        require(avePrice <span style="color:#f92672">==</span> <span style="color:#66d9ef">uint256</span>(<span style="color:#66d9ef">uint128</span>(avePrice)));

        <span style="color:#66d9ef">uint256</span> nextPrice <span style="color:#f92672">=</span> avePrice <span style="color:#f92672">+</span> (avePrice <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>);

        <span style="color:#75715e">// We never auction for less than starting price
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (nextPrice <span style="color:#f92672">&lt;</span> GEN0_STARTING_PRICE) {
            nextPrice <span style="color:#f92672">=</span> GEN0_STARTING_PRICE;
        }

        <span style="color:#66d9ef">return</span> nextPrice;
    }
}


<span style="color:#75715e">/// @title CryptoKitties: Collectible, breedable, and oh-so-adorable cats on the Ethereum blockchain.
</span><span style="color:#75715e">/// @author Axiom Zen (https://www.axiomzen.co)
</span><span style="color:#75715e">/// @dev The main CryptoKitties contract, keeps track of kittens so they don&#39;t wander around and get lost.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">KittyCore</span> <span style="color:#66d9ef">is</span> KittyMinting {

    <span style="color:#75715e">// This is the main CryptoKitties contract. In order to keep our code seperated into logical sections,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// we&#39;ve broken it up in two ways. First, we have several seperately-instantiated sibling contracts
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// that handle auctions and our super-top-secret genetic combination algorithm. The auctions are
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// seperate since their logic is somewhat complex and there&#39;s always a risk of subtle bugs. By keeping
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// them in their own contracts, we can upgrade them without disrupting the main contract that tracks
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// kitty ownership. The genetic combination algorithm is kept seperate so we can open-source all of
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// the rest of our code without making it _too_ easy for folks to figure out how the genetics work.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Don&#39;t worry, I&#39;m sure someone will reverse engineer it soon enough!
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Secondly, we break the core contract into multiple files using inheritence, one for each major
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// facet of functionality of CK. This allows us to keep related code bundled together while still
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// avoiding a single giant file with everything in it. The breakdown is as follows:
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//      - KittyBase: This is where we define the most fundamental code shared throughout the core
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//             functionality. This includes our main data storage, constants and data types, plus
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//             internal functions for managing these items.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//      - KittyAccessControl: This contract manages the various addresses and constraints for operations
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//             that can be executed only by specific roles. Namely CEO, CFO and COO.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//      - KittyOwnership: This provides the methods required for basic non-fungible token
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//             transactions, following the draft ERC-721 spec (https://github.com/ethereum/EIPs/issues/721).
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//      - KittyBreeding: This file contains the methods necessary to breed cats together, including
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//             keeping track of siring offers, and relies on an external genetic combination contract.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//      - KittyAuctions: Here we have the public methods for auctioning or bidding on cats or siring
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//             services. The actual auction functionality is handled in two sibling contracts (one
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//             for sales and one for siring), while auction creation and bidding is mostly mediated
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//             through this facet of the core contract.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//      - KittyMinting: This final facet contains the functionality we use for creating new gen0 cats.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//             We can make up to 5000 &#34;promo&#34; cats that can be given away (especially important when
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//             the community is new), and all others can only be created and then immediately put up
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//             for auction via an algorithmically determined starting price. Regardless of how they
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//             are created, there is a hard limit of 50k gen0 cats. After that, it&#39;s all up to the
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//             community to breed, breed, breed!
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// Set in case the core contract is broken and an upgrade is required
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> newContractAddress;

    <span style="color:#75715e">/// @notice Creates the main CryptoKitties smart contract instance.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">KittyCore</span>() <span style="color:#66d9ef">public</span> {
        <span style="color:#75715e">// Starts paused.
</span><span style="color:#75715e"></span>        paused <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;

        <span style="color:#75715e">// the creator of the contract is the initial CEO
</span><span style="color:#75715e"></span>        ceoAddress <span style="color:#f92672">=</span> msg.sender;

        <span style="color:#75715e">// the creator of the contract is also the initial COO
</span><span style="color:#75715e"></span>        cooAddress <span style="color:#f92672">=</span> msg.sender;

        <span style="color:#75715e">// start with the mythical kitten 0 - so we don&#39;t have generation-0 parent issues
</span><span style="color:#75715e"></span>        _createKitty(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">uint256</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>), <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>));
    }

    <span style="color:#75715e">/// @dev Used to mark the smart contract as upgraded, in case there is a serious
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  breaking bug. This method does nothing but keep track of the new contract and
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  emit a message indicating that the new address is set. It&#39;s up to clients of this
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  contract to update to the new contract address in that case. (This contract will
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  be paused indefinitely if such an upgrade takes place.)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _v2Address new address
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setNewAddress</span>(<span style="color:#66d9ef">address</span> _v2Address) <span style="color:#66d9ef">external</span> onlyCEO whenPaused {
        <span style="color:#75715e">// See README.md for updgrade plan
</span><span style="color:#75715e"></span>        newContractAddress <span style="color:#f92672">=</span> _v2Address;
        ContractUpgrade(_v2Address);
    }

    <span style="color:#75715e">/// @notice No tipping!
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @dev Reject all Ether from being sent here, unless it&#39;s from one of the
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  two auction contracts. (Hopefully, we can prevent user accidents.)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span>() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">payable</span> {
        require(
            msg.sender <span style="color:#f92672">==</span> <span style="color:#66d9ef">address</span>(saleAuction) <span style="color:#f92672">||</span>
            msg.sender <span style="color:#f92672">==</span> <span style="color:#66d9ef">address</span>(siringAuction)
        );
    }

    <span style="color:#75715e">/// @notice Returns all the relevant information about a specific kitty.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @param _id The ID of the kitty of interest.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getKitty</span>(<span style="color:#66d9ef">uint256</span> _id)
        <span style="color:#66d9ef">external</span>
        <span style="color:#66d9ef">view</span>
        <span style="color:#66d9ef">returns</span> (
        <span style="color:#66d9ef">bool</span> isGestating,
        <span style="color:#66d9ef">bool</span> isReady,
        <span style="color:#66d9ef">uint256</span> cooldownIndex,
        <span style="color:#66d9ef">uint256</span> nextActionAt,
        <span style="color:#66d9ef">uint256</span> siringWithId,
        <span style="color:#66d9ef">uint256</span> birthTime,
        <span style="color:#66d9ef">uint256</span> matronId,
        <span style="color:#66d9ef">uint256</span> sireId,
        <span style="color:#66d9ef">uint256</span> generation,
        <span style="color:#66d9ef">uint256</span> genes
    ) {
        Kitty <span style="color:#66d9ef">storage</span> kit <span style="color:#f92672">=</span> kitties[_id];

        <span style="color:#75715e">// if this variable is 0 then it&#39;s not gestating
</span><span style="color:#75715e"></span>        isGestating <span style="color:#f92672">=</span> (kit.siringWithId <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>);
        isReady <span style="color:#f92672">=</span> (kit.cooldownEndBlock <span style="color:#f92672">&lt;=</span> block.number);
        cooldownIndex <span style="color:#f92672">=</span> <span style="color:#66d9ef">uint256</span>(kit.cooldownIndex);
        nextActionAt <span style="color:#f92672">=</span> <span style="color:#66d9ef">uint256</span>(kit.cooldownEndBlock);
        siringWithId <span style="color:#f92672">=</span> <span style="color:#66d9ef">uint256</span>(kit.siringWithId);
        birthTime <span style="color:#f92672">=</span> <span style="color:#66d9ef">uint256</span>(kit.birthTime);
        matronId <span style="color:#f92672">=</span> <span style="color:#66d9ef">uint256</span>(kit.matronId);
        sireId <span style="color:#f92672">=</span> <span style="color:#66d9ef">uint256</span>(kit.sireId);
        generation <span style="color:#f92672">=</span> <span style="color:#66d9ef">uint256</span>(kit.generation);
        genes <span style="color:#f92672">=</span> kit.genes;
    }

    <span style="color:#75715e">/// @dev Override unpause so it requires all external contract addresses
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  to be set before contract can be unpaused. Also, we can&#39;t have
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  newContractAddress set either, because then the contract was upgraded.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// @notice This is public rather than external so we can call super.unpause
</span><span style="color:#75715e"></span>    <span style="color:#75715e">///  without using an expensive CALL.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">unpause</span>() <span style="color:#66d9ef">public</span> onlyCEO whenPaused {
        require(saleAuction <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>));
        require(siringAuction <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>));
        require(geneScience <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>));
        require(newContractAddress <span style="color:#f92672">==</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>));

        <span style="color:#75715e">// Actually unpause the contract.
</span><span style="color:#75715e"></span>        super.unpause();
    }

    <span style="color:#75715e">// @dev Allows the CFO to capture the balance available to the contract.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">withdrawBalance</span>() <span style="color:#66d9ef">external</span> onlyCFO {
        <span style="color:#66d9ef">uint256</span> balance <span style="color:#f92672">=</span> this.balance;
        <span style="color:#75715e">// Subtract all the currently pregnant kittens we have, plus 1 of margin.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint256</span> subtractFees <span style="color:#f92672">=</span> (pregnantKitties <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> autoBirthFee;

        <span style="color:#66d9ef">if</span> (balance <span style="color:#f92672">&gt;</span> subtractFees) {
            cfoAddress.send(balance <span style="color:#f92672">-</span> subtractFees);
        }
    }
}
</code></pre></div>

    


                    
                    <div class="row"><div class="position-relative mx-auto col-lg-9">
                          <div class="bg-primary overflow-hidden p-3 mt-5 shadow">

    <h4 class="text-white text-center">Read more</h4>

    <div class="d-flex justify-content-center"><a class="p-1 mr-3 d-inline-block text-white" href="/posters/mystudy/2021-10-10%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A003/" title="区块链-solidity学习03"><i class="fas fa-chevron-left p-1"></i>区块链-solidity学习03</a>
        <a class="p-1 ml-3 d-inline-block text-white text-right" href="/posters/mystudy/2021-11-01%E5%8C%BA%E5%9D%97%E9%93%BE-solidity%E5%AD%A6%E4%B9%A0-%E9%AB%98%E7%BA%A7%E7%9F%A5%E8%AF%8606/" title=""><i class="fas fa-chevron-right p-1"></i></a>
    </div>
</div>


                        </div></div> 

                </div>

            </div> 

        </div> 
<script src="https://heheiscool.github.io/lib/jquery.min.js"></script> 
<script src="https://heheiscool.github.io/lib/popper.min.js"></script> 

<script src="https://heheiscool.github.io/js/bootstrap.min.js"></script> 


<script type="text/javascript" src="/plugins/lunr.min.js"></script>
<script type="text/javascript" src="/plugins/auto-complete.js"></script>
<link href="/plugins/auto-complete.css" rel="stylesheet">
<script type="text/javascript">
  
      var baseurl = "https:\/\/heheiscool.github.io\/";
  
</script>
<script type="text/javascript" src="/plugins/search.js"></script>


<script type="text/javascript" src="/plugins/clipboard.js"></script>
<script>
  new ClipboardJS('.btn');
</script>
</body>
</html>
